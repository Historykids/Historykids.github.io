 <!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />
  <meta name="theme-color" content="#FCD34D" />
  <meta name="format-detection" content="telephone=no,email=no,address=no" />

  <!-- DNS Prefetch / Preconnectï¼ˆè¨ˆæ¸¬ãƒ»åºƒå‘Šã®åˆé€Ÿæ”¹å–„ï¼‰ -->
  <link rel="dns-prefetch" href="//www.googletagmanager.com">
  <link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>

 <link rel="manifest" href="/manifest.webmanifest" type="application/manifest+json">
 <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js', { scope: '/' });
    });
  }
</script>
 
  <!-- Favicon -->
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32"   href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="48x48"   href="/favicon-48x48.png">
  <link rel="apple-touch-icon"      sizes="180x180" href="/favicon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/favicon-512x512.png">

  <!-- hreflangï¼ˆå°†æ¥ã®å¤šè¨€èªå±•é–‹ã‚’è¦‹è¶Šã—ã¦ï¼‰ -->
  <link rel="alternate" hreflang="ja" href="https://historykids.github.io/">
  <link rel="alternate" hreflang="x-default" href="https://historykids.github.io/">
<!-- SEO -->
  <title>æ­´å²ã‚­ãƒƒã‚ºï½œ3Dã§è¡—ã¥ãã‚Šï¼å°å­¦ç”Ÿãƒ»ä¸­å­¦ç”Ÿãƒ»é«˜æ ¡ç”Ÿå‘ã‘ æ­´å²ã‚¯ã‚¤ã‚ºãƒ»ä¸€å•ä¸€ç­”å½¢å¼ã§æ¥½ã—ãå‹‰å¼·ã§ãã‚‹ï¼ï¼ˆæ±Ÿæˆ¸ãƒ»æˆ¦å›½ãƒ»å®¤ç”ºãƒ»éŒå€‰ï¼‰</title>
  <meta name="description" content="æ­´å²ã‚­ãƒƒã‚ºã¯å°å­¦ç”Ÿãƒ»ä¸­å­¦ç”Ÿãƒ»é«˜æ ¡ç”Ÿå‘ã‘ã®æ­´å²å­¦ç¿’ã‚µã‚¤ãƒˆã€‚æ±Ÿæˆ¸ãƒ»æˆ¦å›½ãƒ»å®¤ç”ºãƒ»éŒå€‰ã®å‡ºæ¥äº‹ã‚’ã€ã²ã‚‰ãŒãªä¸€å•ä¸€ç­”ã‚¯ã‚¤ã‚ºï¼å¹´è¡¨ï¼ˆå›³é‘‘ï¼‰ï¼ç¤¾ä¼šï¼ã‚«ãƒ¼ãƒ‰é›†ã‚ï¼†3Dè¡—ã¥ãã‚Šã§æ¥½ã—ãå‹‰å¼·ã§ãã¾ã™ã€‚ã‚¹ãƒãƒ›æœ€é©åŒ–ãƒ»ç„¡æ–™ã€‚è‡ªç”±ç ”ç©¶ã‚„å—é¨“å¯¾ç­–ã«ã‚‚å½¹ç«‹ã¡ã¾ã™ã€‚" />
  <meta name="keywords" content="æ­´å²,å°å­¦ç”Ÿ,ä¸­å­¦ç”Ÿ,é«˜æ ¡ç”Ÿ,ç¤¾ä¼š,ä¸€å•ä¸€ç­”,ã‚¯ã‚¤ã‚º,å¹´è¡¨,å›³é‘‘,æ±Ÿæˆ¸,æˆ¦å›½,å®¤ç”º,éŒå€‰,è‡ªç”±ç ”ç©¶,ç¤¾ä¼š,æ—¥æœ¬å²,æ­´å²äººç‰©" />
  <link rel="canonical" href="https://historykids.github.io/">

  <!-- OGP -->
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="ja_JP" />
  <meta property="og:url" content="https://historykids.github.io/" />
  <meta property="og:title" content="æ¥½ã—ãå­¦ã¹ã‚‹ï¼å°ä¸­å­¦ç”Ÿã€é«˜æ ¡ç”Ÿå‘ã‘æ­´å²å­¦ç¿’ã‚µã‚¤ãƒˆï½œæ­´å²ã‚­ãƒƒã‚º" />
  <meta property="og:description" content="æ±Ÿæˆ¸ãƒ»æˆ¦å›½ãƒ»å®¤ç”ºãƒ»éŒå€‰ã®å‡ºæ¥äº‹ã‚’ã‚«ãƒ¼ãƒ‰åé›†ã¨3Dè¡—ã¥ãã‚Šã§å­¦ã¹ã‚‹ã€å­ã©ã‚‚å‘ã‘æ­´å²å‹‰å¼·ã‚µã‚¤ãƒˆã€‚ã‚¯ã‚¤ã‚ºï¼å¹´è¡¨ï¼å›³é‘‘ã§ãƒ†ã‚¹ãƒˆãƒ»å—é¨“ã«ã‚‚ã€‚" />
  <meta property="og:image" content="https://historykids.github.io/thumbnail.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="æ¥½ã—ãå­¦ã¹ã‚‹ï¼å°ä¸­å­¦ç”Ÿãƒ»é«˜æ ¡ç”Ÿå‘ã‘æ­´å²å­¦ç¿’ã‚µã‚¤ãƒˆï½œæ­´å²ã‚­ãƒƒã‚º" />
  <meta name="twitter:description" content="æ±Ÿæˆ¸ãƒ»æˆ¦å›½ãƒ»å®¤ç”ºãƒ»éŒå€‰ã®å‡ºæ¥äº‹ã‚’ã‚«ãƒ¼ãƒ‰åé›†ã¨3Dè¡—ã¥ãã‚Šã§å­¦ã¹ã‚‹æ­´å²ã‚µã‚¤ãƒˆã€‚" />
  <meta name="twitter:image" content="https://historykids.github.io/thumbnail.png" />

  <!-- Google tag (gtag.js) â€»1å›ã®ã¿ -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-EZP12GC8W1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-EZP12GC8W1');
    gtag('config', 'G-6Z9WN4HFK5');
  </script>

  <!-- AdSenseï¼ˆ1å›ã ã‘ï¼‰ -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4922140858632050" crossorigin="anonymous"></script>

  <!-- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆWebSite + SitelinksSearchBoxï¼‰ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "name":"æ­´å²ã‚­ãƒƒã‚º",
    "url":"https://historykids.github.io/",
    "inLanguage":"ja",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"https://historykids.github.io/?q={search_term_string}#cards",
      "query-input":"required name=search_term_string"
    }
  }
  </script>

  <!-- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆWebPageï¼‰ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"æ­´å²ã‚­ãƒƒã‚ºï½œæ­´å²ã‚¯ã‚¤ã‚ºãƒ»å¹´è¡¨ãƒ»å›³é‘‘",
    "url":"https://historykids.github.io/",
    "description":"æ±Ÿæˆ¸ãƒ»æˆ¦å›½ãƒ»å®¤ç”ºãƒ»éŒå€‰ã‚’ã€ã‚¯ã‚¤ã‚ºï¼å¹´è¡¨ï¼ˆå›³é‘‘ï¼‰ï¼ã‚«ãƒ¼ãƒ‰é›†ã‚ï¼†3Dè¡—ã¥ãã‚Šã§å‹‰å¼·ã§ãã‚‹ã‚µã‚¤ãƒˆã€‚è‡ªç”±ç ”ç©¶ã«ã‚‚ãŠã™ã™ã‚ï¼å°å­¦ç”Ÿãƒ»ä¸­å­¦ç”Ÿå‘ã‘ã«ã‚¹ãƒãƒ›æœ€é©åŒ–ã€‚"
  }
  </script>

  <!-- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆFAQï¼‰ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "inLanguage":"ja",
    "mainEntity":[
      {"@type":"Question","name":"å¯¾è±¡ã¯å°å­¦ç”Ÿã§ã™ã‹ï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"ã¯ã„ã€‚å¹´å°‘ã€œå°å­¦æ ¡ä½å­¦å¹´ã€ä¸­å­¦ç”Ÿã§ã‚‚éŠã³ãªãŒã‚‰æ­´å²ã«è¦ªã—ã‚ã‚‹ã‚ˆã†ã«ã€ã²ã‚‰ãŒãªã‚¯ã‚¤ã‚ºã‚„å›³é‘‘ï¼ˆå¹´è¡¨ï¼‰ã§ã‚„ã•ã—ãå­¦ã¹ã¾ã™ã€‚"}},
      {"@type":"Question","name":"ç„¡æ–™ã§ä½¿ãˆã¾ã™ã‹ï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"ç„¡æ–™ã§åˆ©ç”¨ã§ãã¾ã™ã€‚ã‚µã‚¤ãƒˆä¸‹éƒ¨ã«åºƒå‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"}},
      {"@type":"Question","name":"ã©ã‚“ãªå­¦ç¿’å†…å®¹ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"æ±Ÿæˆ¸ãƒ»æˆ¦å›½ãƒ»å®¤ç”ºãƒ»éŒå€‰ã®å‡ºæ¥äº‹ã‚’ã€å¹´ã¨å‡ºæ¥äº‹ã‚’çµã³ã¤ã‘ã‚‹ã‚¯ã‚¤ã‚ºã€å¹´è¡¨ã®æ‹¡å¼µè¡¨ç¤ºã€ã‚«ãƒ¼ãƒ‰åé›†ã¨3Dã®è¡—ã¥ãã‚Šæ¼”å‡ºã§å­¦ã¹ã¾ã™ã€‚"}},
      {"@type":"Question","name":"è‡ªç”±ç ”ç©¶ã«ä½¿ãˆã¾ã™ã‹ï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"ã¯ã„ã€‚æ­´å²äººç‰©ã‚„å¹´è¡¨ã‚’ã¾ã¨ã‚ã¦è‡ªç”±ç ”ç©¶ã‚„èª¿ã¹å­¦ç¿’ã«æ´»ç”¨ã§ãã¾ã™ã€‚"}},
      {"@type":"Question","name":"ã‚¹ãƒãƒ›ã‚„ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§ã‚‚ä½¿ãˆã¾ã™ã‹ï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"ã¯ã„ã€‚ç¸¦ç”»é¢ãƒ»1ç”»é¢ã§éŠã¹ã‚‹ã‚ˆã†æœ€é©åŒ–ã—ã¦ã„ã¾ã™ã€‚"}}
    ]
  }
  </script>

  <!-- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆBreadcrumbListï¼‰ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"ãƒ›ãƒ¼ãƒ ","item":"https://historykids.github.io/"},
      {"@type":"ListItem","position":2,"name":"å­¦ç¿’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„","item":"https://historykids.github.io/#cards"}
    ]
  }
  </script>

  <!-- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆé‹å–¶è€…ï¼‰ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Person",
    "name":"ã—ã‚ãªãŒã™",
    "jobTitle":"æ­´å²ã‚­ãƒƒã‚º é‹å–¶è€…",
    "url":"https://historykids.github.io/",
    "image":"https://historykids.github.io/æ­´å²ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ç´¹ä»‹.png",
    "sameAs":[
      "https://x.com/your_handle",
      "https://github.com/your_github"
    ],
    "inLanguage":"ja"
  }
  </script>

  <!-- Search Console æ‰€æœ‰æ¨© -->
  <meta name="google-site-verification" content="bgJFyYeBgPsces8Rz5ONG_d-nj8ZEH_fHddcwAXMX0U" />

  <!-- ===== Styles ===== -->
  <style>
  :root{
    --edo-yellow:#FCD34D;
    --edo-info:#FFF8DC;
    --edo-border:#b89233;
    --bg:#fff7ec;
    --surface:#ffffff;
    --surface-muted:#fff0d7;
    --surface-soft:#fff9ef;
    --ink:#1f2933;
    --ink-light:#4b5563;
    --shadow:rgba(15,23,42,.12);
    --shadow-lg:rgba(15,23,42,.18);
    --radius-lg:24px;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(130% 100% at 0% 0%, rgba(252,211,77,.22) 0%, transparent 55%),
      radial-gradient(100% 120% at 100% 0%, rgba(249,168,212,.22) 0%, transparent 56%),
      linear-gradient(180deg,#fffdf4 0%,#fff7ec 48%,#fffdf7 100%);
    color:var(--ink);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,
      "Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif;
    line-height:1.6;
  }
  a{color:inherit}
  h1,h2,h3{color:var(--ink)}
  h2{font-size:clamp(18px,3.2vw,22px);line-height:1.35;}

  .wrap{display:flex;flex-direction:column;min-height:100svh;}
  header{
    position:sticky;top:0;z-index:3;
    background:linear-gradient(135deg,rgba(252,211,77,.95),rgba(251,146,60,.95));
    padding:14px 20px;
    box-shadow:0 6px 20px rgba(249,168,38,.25);
    backdrop-filter:blur(6px);
  }
  header::after{
    content:"";
    position:absolute;
    inset:0;
    background:radial-gradient(120% 100% at 0% 0%,rgba(255,255,255,.25) 0%,transparent 60%);
    pointer-events:none;
  }
  .header-inner{
    max-width:1120px;
    margin:0 auto;
    display:grid;
    gap:12px;
    position:relative;
    z-index:1;
  }
  header h1.siteTitle{
    margin:0;
    font-size:clamp(16px,2.5vw,24px);
    line-height:1.25;
    font-weight:800;
    text-shadow:0 2px 6px rgba(0,0,0,.08);
  }
  header .controls{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    align-items:center;
  }
  header label{
    font-size:12px;
    font-weight:600;
    text-transform:uppercase;
    letter-spacing:.08em;
    color:rgba(31,41,51,.88);
  }
  header button,
  header select{
    border:0;
    border-radius:12px;
    background:#fff;
    padding:8px 14px;
    font-weight:700;
    box-shadow:0 2px 6px rgba(0,0,0,.16);
    cursor:pointer;
    transition:transform .2s,box-shadow .2s,filter .2s;
  }
  header select{
    appearance:none;
    padding-right:32px;
    background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23333"><path d="M4 6l4 4 4-4z"/></svg>');
    background-repeat:no-repeat;
    background-position:right 12px center;
    background-size:14px;
  }
  header button:hover,
  header select:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(0,0,0,.18);}
  header button:focus-visible,
  header select:focus-visible{outline:3px solid rgba(59,130,246,.65);outline-offset:2px;}
  #resetBtn{background:#ffe4e6;color:#c53030;}
  .moneybox{
    margin-left:auto;
    background:linear-gradient(135deg,#fff,#fff7d4);
    border-radius:14px;
    padding:8px 14px;
    box-shadow:0 3px 10px rgba(0,0,0,.18);
    font-weight:700;
    display:flex;
    align-items:center;
    gap:6px;
  }
  #openShopBtn{
    background:linear-gradient(135deg,#fde68a,#fbbf24);
    color:#6b3a00;
  }
  main.content{
    flex:1;
    width:min(1120px,calc(100% - 32px));
    margin:16px auto 48px;
    display:flex;
    flex-direction:column;
    gap:20px;
  }
  #intro{
    background:var(--surface);
    border-radius:var(--radius-lg);
    padding:26px;
    box-shadow:0 18px 48px rgba(15,23,42,.12);
    position:relative;
    overflow:hidden;
    display:grid;
    gap:24px;
    align-items:center;
  }
  #intro::before{
    content:"";
    position:absolute;
    inset:-30% 40% auto -30%;
    height:120%;
    background:radial-gradient(ellipse at center,rgba(252,211,77,.25) 0%,transparent 70%);
    opacity:.8;
    pointer-events:none;
  }
  #intro::after{
    content:"";
    position:absolute;
    inset:auto -25% -60% 50%;
    height:120%;
    background:radial-gradient(ellipse at center,rgba(191,219,254,.28) 0%,transparent 70%);
    pointer-events:none;
  }
  #intro .hero-content{display:flex;flex-direction:column;gap:16px;position:relative;z-index:1;}
  #intro p{margin:0;font-size:16px;color:var(--ink-light);}
  .hero-highlights{display:grid;gap:8px;}
  .hero-highlights h2{
    margin:0;
    font-size:clamp(12px,1.4vw,14px);
    line-height:1.4;
    display:flex;
    align-items:center;
    gap:6px;
    padding:4px 10px;
    border-radius:14px;
    background:linear-gradient(120deg,rgba(252,211,77,.28),rgba(255,255,255,.9));
    box-shadow:0 1px 0 rgba(255,255,255,.7) inset;
  }
  .hero-highlights h2::before{content:"âœ¨";font-size:14px;}
  .hero-actions{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .cta{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:6px;
    padding:9px 16px;
    border-radius:999px;
    font-weight:700;
    text-decoration:none;
    transition:transform .2s,box-shadow .2s,filter .2s;
    box-shadow:0 8px 18px rgba(15,23,42,.12);
  }
  .cta:hover{transform:translateY(-2px);box-shadow:0 12px 28px rgba(15,23,42,.16);}
  .cta:focus-visible{outline:3px solid rgba(59,130,246,.6);outline-offset:2px;}
  .cta.edo{background:linear-gradient(130deg,#fcd34d,#fbbf24);color:#5c3b00;}
  .cta.sengoku{background:linear-gradient(130deg,#f6d5a4,#f59e0b);color:#5b3510;}
  .cta.muromachi{background:linear-gradient(130deg,#fde68a,#facc15);color:#5b4410;}
  .cta.kamakura{background:linear-gradient(130deg,#f9e2af,#fbcfe8);color:#653a32;}
  .cta.outline{background:rgba(255,255,255,.78);border:2px solid rgba(17,24,39,.12);box-shadow:none;}
  .cta.soft{background:linear-gradient(130deg,#e0f2fe,#bfdbfe);color:#1d4ed8;}
  .cta.success{background:linear-gradient(130deg,#dcfce7,#bbf7d0);color:#166534;}
  .cta.highlight{background:linear-gradient(120deg,#ffd814,#fbbf24);color:#4a3300;}
  .promoBar{
    background:var(--surface);
    border-radius:20px;
    padding:18px 22px;
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    align-items:center;
    box-shadow:0 12px 32px rgba(15,23,42,.12);
    border:1px solid rgba(249,168,38,.15);
  }
  .promoBar .promo-badge{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:4px 12px;
    border-radius:999px;
    font-weight:700;
    letter-spacing:.08em;
    font-size:12px;
    background:#f59e0b;
    color:#fff;
  }
  .promoBar .title{font-weight:700;color:var(--ink);}
  .promoBar small{color:var(--ink-light);}
  #info{
    padding:12px 16px;
    background:linear-gradient(120deg,rgba(224,242,254,.85),rgba(219,234,254,.85));
    border-radius:18px;
    border:1px solid rgba(59,130,246,.18);
    font-size:15px;
    min-height:40px;
    display:flex;
    align-items:center;
    gap:8px;
    box-shadow:0 6px 16px rgba(15,23,42,.1);
    color:#1e3a5f;
  }
  #info::before{content:"ğŸ“˜";font-size:20px;}

  #town{
    position:relative;width:100%;height:clamp(260px,44vh,520px);background:var(--surface);
    border-radius:24px;border:1px solid rgba(17,24,39,.08);box-shadow:0 20px 48px rgba(15,23,42,.16);overflow:hidden;
  }
  @media (min-width: 1024px){ #town{ height:clamp(320px, 50vh, 640px); } }
  #town > canvas{ display:block;width:100%;height:100%; touch-action:none;
    background-image: radial-gradient(rgba(0,0,0,.04) 1px, transparent 1px);
    background-size: 20px 20px; }

  .place-hud{
    position: fixed; right: 12px; bottom: 12px; z-index: 200;
    display: flex; gap: 8px; padding: 10px; border-radius: 14px;
    background: rgba(255,255,255,.92); box-shadow: 0 12px 30px rgba(15,23,42,.18);
  }
  .place-hud button{
    border: 0; border-radius: 12px; padding: 10px 14px; font-weight: 700;
    box-shadow: 0 3px 8px rgba(15,23,42,.16); cursor: pointer;
    transition:transform .2s,box-shadow .2s;
  }
  .place-hud button:hover{transform:translateY(-1px);}
  .place-hud #btnRotate{ background:#e0f2fe; }
  .place-hud #btnCancel{ background:#fee2e2; }

  #cards{
    display:grid;gap:12px;padding:18px;
    grid-template-columns:repeat(auto-fill, minmax(104px, 1fr));
    background:var(--surface);
    border-radius:24px;
    box-shadow:0 18px 48px rgba(15,23,42,.12);
  }
  @media (min-width: 768px){
    #cards{ grid-template-columns:repeat(auto-fill, minmax(140px, 1fr)); }
  }
  .card{
    height:clamp(110px,18vw,140px);border-radius:16px;background:linear-gradient(135deg,rgba(252,211,77,.35),rgba(255,255,255,.9));
    display:flex;align-items:center;justify-content:center;font-weight:700;font-size:15px;
    cursor:pointer;box-shadow:0 6px 16px rgba(15,23,42,.12);user-select:none;text-align:center;padding:8px;
    transition:transform .2s, box-shadow .2s,filter .2s
  }
  .card:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 14px 28px rgba(15,23,42,.16)}
  .card.done{background:linear-gradient(135deg,rgba(187,247,208,.95),rgba(134,239,172,.9));color:#14532d}

  .villager{position:absolute;font-size:20px;animation:walk 8s linear infinite}
  @keyframes walk{0%{left:2%}50%{left:90%}100%{left:2%}}

  #zukanPanel{position:fixed;inset:0 0 auto 0;height:72%;top:-100%;background:var(--surface);
    border-bottom:3px solid #333;box-shadow:0 18px 36px rgba(15,23,42,.2);
    transition:top .45s ease;z-index:5;overflow:auto}
  #zukanPanel.active{top:0}
  #zukanHead{position:sticky;top:0;background:var(--surface);padding:12px 16px;border-bottom:1px solid #eee;
    display:flex;align-items:center;gap:8px}
  #zukanHead h2{margin:0;font-size:18px}
  #closeZukan{margin-left:auto;border:0;background:#f1f5f9;border-radius:10px;padding:6px 12px;cursor:pointer;font-weight:600}
  .zukanSec{padding:16px}
  .zukanSec h3{margin:8px 0}
  .zCard{display:inline-flex;align-items:center;justify-content:center;width:96px;height:116px;margin:4px;
    border:1px solid #ccc;border-radius:10px;box-shadow:0 6px 12px rgba(15,23,42,.12);white-space:pre-line;text-align:center;padding:6px;background:#fff}
  .locked{background:#f1f5f9;color:#94a3b8}
  #completeMsg{font-size:18px;font-weight:800;color:green;text-align:center;padding:16px}

  .petal{position:fixed;top:-10px;font-size:20px;animation:fall linear forwards;pointer-events:none}
  @keyframes fall{to{transform:translateY(110vh) rotate(360deg);opacity:0}}

  .adbar{position:sticky;bottom:0;background:rgba(255,255,255,.92);border-top:1px solid rgba(15,23,42,.08);
    padding:8px 12px;display:flex;justify-content:center;align-items:center;min-height:56px;
    backdrop-filter:blur(6px);border-radius:18px 18px 0 0;box-shadow:0 -10px 20px rgba(15,23,42,.12)}
  .adslot{width:100%;max-width:728px;height:50px;background:
    repeating-linear-gradient(45deg,#f3f4f6,#f3f4f6 8px,#e5e7eb 8px,#e5e7eb 16px);
    border:1px dashed #bbb;border-radius:12px;display:flex;align-items:center;justify-content:center;
    font-size:12px;color:#666}
  footer{height:12px}

  .landscapeWarn{
    position:fixed;inset:0;background:rgba(0,0,0,.65);color:#fff;display:none;
    align-items:center;justify-content:center;z-index:20;text-align:center;padding:20px
  }
  @media (orientation:landscape) and (max-width: 768px){ .landscapeWarn{display:flex} }

  ruby rt{font-size:.7em;color:#444}
  .yr{font-weight:800;margin-right:2px}

  /* ãƒ¢ãƒ¼ãƒ€ãƒ«å…±é€š */
  .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center;
 z-index:100; }
  .modal-overlay.active { display:flex; }
  .modal-box { background:var(--surface); border-radius:18px; max-width:640px; width:92%; max-height:90vh; overflow:auto; padding:24px; box-shadow:0 24px 60px rgba(15,23,42,.3); position:relative; }
  .modal-box h2 { margin-top:0; font-size:20px; }
  .modal-close { position:absolute; top:14px; right:14px; border:0; background:#e2e8f0; border-radius:50%; width:36px; height:36px; cursor:pointer; font-weight:800; display:grid; place-items:center; }
  .profile-card{display:flex;flex-direction:column;gap:12px;align-items:center;text-align:center;}
  @media (min-width:580px){.profile-card{flex-direction:row;text-align:left;align-items:center;}}
  .profile-avatar{width:176px;height:auto;border-radius:20px;box-shadow:0 10px 24px rgba(15,23,42,.18);}
  .profile-meta{display:flex;flex-direction:column;gap:10px;color:var(--ink-light);}
  .profile-meta p{margin:0;}
  .profile-name{font-weight:700;font-size:18px;color:var(--ink);}
  .profile-list{margin:0;padding-left:18px;color:var(--ink-light);}
  .profile-list li{margin-bottom:6px;}
  .socials{display:flex;gap:8px;}
  .chip{display:inline-flex;align-items:center;justify-content:center;padding:8px 12px;border-radius:999px;background:linear-gradient(120deg,#e0f2fe,#bfdbfe);font-weight:700;color:#1d4ed8;text-decoration:none;}
  #contactModal p{color:var(--ink-light);margin:0 0 12px;}
  #contactModal p:last-child{margin:0;}
  #contactModal a{display:inline-flex;align-items:center;justify-content:center;background:linear-gradient(130deg,#fcd34d,#fbbf24);padding:10px 16px;border-radius:999px;font-weight:700;color:#4a3300;text-decoration:none;box-shadow:0 8px 18px rgba(15,23,42,.12);}

  /* ã‚·ãƒ§ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« */
  .shop-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;
    align-items:center;justify-content:center;z-index:120}
  .shop-overlay.active{display:flex}
  .shop-box{background:var(--surface);border-radius:20px;max-width:760px;width:94%;max-height:90vh;
    overflow:auto;padding:18px;box-shadow:0 24px 60px rgba(15,23,42,.3);position:relative}
  .shop-box h2{margin:0 0 8px;font-size:18px;}
  .shop-close{position:absolute;top:12px;right:12px;border:0;background:#e2e8f0;border-radius:50%;
    width:36px;height:36px;cursor:pointer;font-weight:800}
  .shop-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px}
  .shop-card{border:1px solid rgba(15,23,42,.08);border-radius:14px;padding:12px;box-shadow:0 10px 20px rgba(15,23,42,.1);background:var(--surface-soft);display:flex;flex-direction:column;gap:6px}
  .shop-card h4{margin:0 0 4px 0;font-size:15px;color:var(--ink)}
  .shop-card .preview{font-size:28px;height:36px;display:flex;align-items:center;justify-content:center}
  .shop-card .buyrow{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:8px}
  .shop-card button{border:0;border-radius:10px;padding:8px 10px;font-weight:700;cursor:pointer;
    box-shadow:0 6px 12px rgba(15,23,42,.12);background:linear-gradient(130deg,#e0f2fe,#bfdbfe);color:#1d4ed8}
  .shop-card .price{color:var(--ink-light)}
  .shop-tip{font-size:13px;color:var(--ink-light);margin:10px 0 0}
  .toolrow{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 0}
  .toolrow .toolbtn{border:1px solid rgba(15,23,42,.12);background:#fff;border-radius:10px;padding:6px 10px;cursor:pointer;transition:background .2s,border-color .2s,box-shadow .2s}
  .toolrow .toolbtn.active{background:#e6f4ff;border-color:#8ecbff;box-shadow:0 3px 8px rgba(15,23,42,.12)}

  /* ===== ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ ===== */
   #ui-toolbar{
  position: fixed; z-index: 9999; top: 16px; right: 16px;
  display: flex; gap: 8px; align-items: center;
  background: rgba(255,255,255,.9);
  border: 1px solid #e5e7eb; border-radius: 12px; padding: 8px 10px;
  box-shadow: 0 6px 20px rgba(0,0,0,.12);
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
}
#ui-toolbar button{
  appearance: none; border: 1px solid #e5e7eb; border-radius: 10px;
  background: #fff; padding: 6px 10px; cursor: pointer; font-size: 14px;
}
#ui-toolbar button.active{ background: #fcd34d; border-color: #f59e0b; }
#ui-toolbar #ui-hint{ margin-left: 4px; font-size: 13px; color: #374151; }
canvas { outline: none; } /* ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã®é’æ é˜²æ­¢ */



    /* ===== ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ ===== */
.joypad{
  position: fixed; left: 12px; bottom: 12px; z-index: 220;
  width: 120px; height: 120px; touch-action: none; user-select: none;
}
.joypad .joy-base{
  position: absolute; inset: 0;
  border-radius: 999px; background: rgba(255,255,255,.9);
  box-shadow: 0 4px 16px rgba(0,0,0,.18), inset 0 0 0 2px rgba(0,0,0,.08);
}
.joypad .joy-stick{
  position: absolute; left: 50%; top: 50%; width: 56px; height: 56px;
  margin-left: -28px; margin-top: -28px; border-radius: 999px;
  background: rgba(0,0,0,.18); backdrop-filter: blur(2px);
  box-shadow: 0 2px 10px rgba(0,0,0,.22);
  transition: transform .05s linear;
}

  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:30;}

  </style>
</head>

<body>
<!-- admax -->
<!-- admax -->

<div class="wrap">
  <header>
    <div class="header-inner">
      <h1 class="siteTitle">æ­´å²ã‚­ãƒƒã‚ºï½œæ¥½ã—ãå­¦ã¹ã‚‹ï¼å°å­¦ç”Ÿãƒ»ä¸­å­¦ç”Ÿå‘ã‘æ­´å²å­¦ç¿’ã‚µã‚¤ãƒˆ</h1>

      <div class="controls">
        <label for="eraSelect">æ™‚ä»£ï¼š</label>
        <select id="eraSelect" title="æ™‚ä»£ã‚’ãˆã‚‰ã¶">
          <option value="edo">æ±Ÿæˆ¸æ™‚ä»£</option>
          <option value="muromachi">å®¤ç”ºæ™‚ä»£</option>
          <option value="kamakura">éŒå€‰æ™‚ä»£</option>
          <option value="sengoku">æˆ¦å›½æ™‚ä»£</option>
        </select>

        <select id="chapterFilter" title="ç« ã‚’ãˆã‚‰ã¶">
          <option value="ALL">ç« ï¼šãœã‚“ã¶</option>
        </select>

        <button id="zukanBtn" aria-controls="zukanPanel" aria-expanded="false">å›³é‘‘</button>
        <button id="resetBtn" title="é€²æ—ã‚’å…¨éƒ¨æ¶ˆã—ã¦æœ€åˆã‹ã‚‰">ãƒªã‚»ãƒƒãƒˆ</button>

        <!-- æ‰€æŒé‡‘ã¨ã‚·ãƒ§ãƒƒãƒ— -->
        <div class="moneybox" aria-live="polite">
          ğŸ’° <b id="moneyValue">0</b> ä¸¡
        </div>
        <button id="openShopBtn" title="ã‚·ãƒ§ãƒƒãƒ—ã‚’é–‹ã">ã‚·ãƒ§ãƒƒãƒ—</button>
      </div>
    </div>
  </header>

  <main class="content">
    <section id="intro">
      <div class="hero-content">
        <p>
          å°å­¦ç”Ÿãƒ»ä¸­å­¦ç”Ÿãƒ»é«˜æ ¡ç”Ÿå‘ã‘ã®<strong>æ­´å²å­¦ç¿’ã‚µã‚¤ãƒˆ</strong>ã§ã™ã€‚<br>
          <b>æ±Ÿæˆ¸ãƒ»æˆ¦å›½ãƒ»å®¤ç”ºãƒ»éŒå€‰</b>ã®å‡ºæ¥äº‹ã‚’ã€<b>ã‚¯ã‚¤ã‚º</b>ã¨<b>å¹´è¡¨</b>ã€<b>ã‚«ãƒ¼ãƒ‰é›†ã‚</b>ã§æ¥½ã—ãå­¦ã¹ã¾ã™ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œãƒ»ç„¡æ–™ï¼‰ã€‚
        </p>
        <div class="hero-highlights">
          <h2>æˆ¦å›½ã€æ±Ÿæˆ¸ã€å®¤ç”ºã€éŒå€‰ã‚’å‹‰å¼·ã§ãã‚‹ï¼</h2>
          <h2>ãƒ†ã‚¹ãƒˆã‚„å—é¨“å‹‰å¼·ã«å½¹ç«‹ã¤ï¼</h2>
          <h2>3Dã§è¡—ã¥ãã‚ŠãŒã§ãã‚‹ï¼</h2>
        </div>

        <nav class="hero-actions">
          <a href="#cards" id="playEdo" class="cta edo">æ±Ÿæˆ¸æ™‚ä»£ã§éŠã¶</a>
          <a href="#cards" id="playSengoku" class="cta sengoku">æˆ¦å›½æ™‚ä»£ã§éŠã¶</a>
          <a href="#cards" id="playMuromachi" class="cta muromachi">å®¤ç”ºæ™‚ä»£ã§éŠã¶</a>
          <a href="#cards" id="playKamakura" class="cta kamakura">éŒå€‰æ™‚ä»£ã§éŠã¶</a>
          <a href="#zukanPanel" id="openZukan" class="cta outline">å›³é‘‘ï¼ˆå¹´è¡¨ï¼‰ã‚’è¦‹ã‚‹</a>
          <a href="#" id="openProfile" class="cta soft">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a>
          <a href="#" id="openContact" class="cta success">ãŠå•ã„åˆã‚ã›</a>
        </nav>
         </div>
     </section>

    <!-- PR -->
    <aside class="promoBar" role="note" aria-label="ãŠã™ã™ã‚ã®æœ¬ï¼ˆPRï¼‰">
      <span class="promo-badge">PR</span>
      <span class="title">æ­´å²å…¥é–€ã«ã´ã£ãŸã‚Šï¼<strong>ãƒ‰ãƒ©ãˆã‚‚ã‚“ã®ç¤¾ä¼šç§‘ãŠã‚‚ã—ã‚æ”»ç•¥ æ—¥æœ¬ã®æ­´å²</strong>ï¼ˆå°å­¦é¤¨ï¼‰</span>
      <a id="promoLink" class="cta highlight" href="https://amzn.asia/d/bu7qdsv" target="_blank" rel="noopener sponsored nofollow">
        Amazonã§è¦‹ã‚‹
      </a>
      <small>â€»å½“ã‚µã‚¤ãƒˆã¯ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆåºƒå‘Šã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™</small>
    </aside>

    <div id="info" role="status" aria-live="polite">æ™‚ä»£ã‚’ãˆã‚‰ã‚“ã§ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚ã†ï¼ ã€‡ã®éƒ¨åˆ†ã ã‘ã‚’ã€Œã²ã‚‰ãŒãªã€ã§ç­”ãˆã‚‹ã¨é–‹ãã‚ˆã€‚</div> <footer>
  <a href="/Credits.html" rel="nofollow">3D Model Credits</a>
</footer>
   <!-- ğŸ”§ ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
<div id="ui-toolbar">
  <button id="btn-select" class="active" title="ã‚¯ãƒªãƒƒã‚¯ã§å»ºç‰©ã‚’é¸æŠ">é¸æŠ</button>
  <button id="btn-move"   title="é¸æŠã—ãŸå»ºç‰©ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•">ç§»å‹•</button>
  <button id="btn-delete" title="é¸æŠorã‚¯ãƒªãƒƒã‚¯ã—ãŸå»ºç‰©ã‚’å‰Šé™¤">å‰Šé™¤</button>
  <span id="ui-hint">ãƒ¢ãƒ¼ãƒ‰: é¸æŠ</span>
</div>

 <!-- ======== ã“ã“ãŒè¡—ï¼ˆ3Dï¼‰ ======== -->
  <div id="town" role="img" aria-label="ç”ºã‚¨ãƒªã‚¢"></div>

  <div id="cards" aria-label="ã‚«ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢"></div>

  <section id="zukanPanel" aria-hidden="true">
    <div id="zukanHead">
      <h2>ã‚«ãƒ¼ãƒ‰å›³é‘‘ï¼ˆç« ã”ã¨ï¼‰</h2>
      <button id="closeZukan" aria-label="å›³é‘‘ã‚’ã¨ã˜ã‚‹">ã¨ã˜ã‚‹</button>
    </div>
    <div id="zukanList"></div>
    <div id="completeMsg"></div>
  </section>

  <!-- åºƒå‘Šæ  -->
  <div class="adbar" aria-label="åºƒå‘Šæ ">
    <div class="adslot">åºƒå‘Šã‚¹ãƒšãƒ¼ã‚¹</div>
  </div>
  <footer aria-hidden="true"></footer>
  </main>

  <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« / ãŠå•ã„åˆã‚ã› ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="profileModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="profileTitle">
    <div class="modal-box">
      <button class="modal-close" data-close>Ã—</button>
      <h2 id="profileTitle">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h2>
      <div class="profile-card">
        <img src="https://historykids.github.io/ã‹ã‚ã„ã„é’ã„ã‚¯ã‚¸ãƒ©.png" alt="ã‚µã‚¤ãƒˆç®¡ç†äººã®ã‚¢ã‚¤ã‚³ãƒ³" class="profile-avatar" width="176" height="176" loading="lazy" decoding="async" />
        <div class="profile-meta">
          <div class="profile-name">ã‚µã‚¤ãƒˆç®¡ç†äººï¼š<b>ã—ã‚ãªãŒã™</b></div>
          <p>å°å­¦ç”Ÿã€œé«˜æ ¡ç”ŸãŒ <b>ã‚¯ã‚¤ã‚ºãƒ»å¹´è¡¨ãƒ»ã‚«ãƒ¼ãƒ‰</b>ã§æ­´å²ã«è¦ªã—ã‚ã‚‹ã‚µã‚¤ãƒˆã‚’ç›®æŒ‡ã—ã¦é–‹ç™ºãƒ»é‹å–¶ã—ã¦ã„ã¾ã™ã€‚</p>
          <ul class="profile-list">
            <li>ã“ã©ã‚‚ã§ã‚‚<b>ã‚¹ãƒãƒ›ï¼‘å°</b>ã§å­¦ã¹ã‚‹UIã«</li>
            <li>èª­ã¿ã‚„ã™ã„ <b>ãµã‚ŠãŒãª</b> ã¨ <b>ã²ã‚‰ãŒãªå›ç­”</b>ã«å¯¾å¿œ</li>
            <li>å­¦æ ¡ã® <b>è‡ªç”±ç ”ç©¶</b>ã‚„ <b>ãƒ†ã‚¹ãƒˆå¯¾ç­–</b>ã«ã‚‚æ´»ç”¨</li>
          </ul>
          <div class="socials" aria-label="SNSãƒªãƒ³ã‚¯">
            <a class="chip" href="mailto:you@example.com">ãƒ¡ãƒ¼ãƒ«</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="contactModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="contactTitle">
    <div class="modal-box">
      <button class="modal-close" data-close>Ã—</button>
      <h2 id="contactTitle">ãŠå•ã„åˆã‚ã›</h2>
      <p>ã”æ„è¦‹ãƒ»ã”è¦æœ›ãƒ»èª¤å­—ã®ã”æŒ‡æ‘˜ãªã©ã€ãŠæ°—è»½ã«ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚</p>
      <p><a href="https://docs.google.com/forms/d/e/1FAIpQLSdHvqKAszs5j860tNIeesVlE83pMpP_qP9QrNLuJJaZ9g3h5Q/viewform" target="_blank" rel="noopener">Googleãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã</a></p>
    </div>
  </div>

  <!-- ===== ã‚·ãƒ§ãƒƒãƒ— ãƒ¢ãƒ¼ãƒ€ãƒ« ===== -->
  <div id="shopOverlay" class="shop-overlay" role="dialog" aria-modal="true" aria-labelledby="shopTitle">
    <div class="shop-box">
      <button id="shopClose" class="shop-close" aria-label="ã‚·ãƒ§ãƒƒãƒ—ã‚’ã¨ã˜ã‚‹">Ã—</button>
      <h2 id="shopTitle">ã‚·ãƒ§ãƒƒãƒ—</h2>
      <div class="toolrow">
        <button class="toolbtn" data-filter="ALL">ã™ã¹ã¦</button>
        <button class="toolbtn" data-filter="building">å»ºç‰©</button>
        <button class="toolbtn" data-filter="nature">è‡ªç„¶</button>
        <button class="toolbtn" data-filter="infrastructure">ã‚¤ãƒ³ãƒ•ãƒ©</button>
      </div>
      <div id="shopGrid" class="shop-grid" aria-live="polite"></div>
      <p class="shop-tip">ã‚¯ã‚¤ã‚ºã«æ­£è§£ã™ã‚‹ã¨ğŸ’°ãŒãµãˆã¾ã™ã€‚è²·ã£ãŸå»ºç‰©ã¯å¥½ããªå ´æ‰€ã«ç½®ã‘ã¾ã™ã€‚</p>
    </div>
  </div>
</div>

<div class="landscapeWarn">ç¸¦å‘ãã§éŠã‚“ã§ã­ğŸ”„</div>

<!-- ã‚¯ã‚¤ã‚ºç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="quizModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:30">
  <div class="modal-bg" id="quizBg" style="position:absolute;inset:0;background:rgba(0,0,0,.5)"></div>
  <div class="modal-box" style="position:relative;z-index:1;width:min(92vw,560px);background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.2);padding:14px">
    <div id="quizTitle" class="quiz-title" style="font-weight:800;font-size:16px;margin:0 0 6px 0"></div>
    <p class="quiz-instruction" style="font-size:14px;margin:6px 0 10px 0;color:#444">
      ã€‡ã®ã¨ã“ã‚ã ã‘ã‚’ <b>ã²ã‚‰ãŒãª</b> ã§ã“ãŸãˆã¦ã­ã€‚<br>
      ç©ºæ¬„ãŒã„ãã¤ã‹ã‚ã‚‹ã¨ãã¯ <b>ã‚¹ãƒšãƒ¼ã‚¹ / ãƒ» / ã€ / ï¼</b> ã§åŒºåˆ‡ã£ã¦OKã€‚
      <span id="quizHint" style="color:#666"></span>
    </p>
    <input id="quizInput" type="text" inputmode="text" autocomplete="off"
           placeholder="ã“ã“ã« ã²ã‚‰ãŒãª ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šã¦ã‚“ã½ã†ï¼‰"
           style="width:100%;padding:10px 12px;font-size:16px;border:1px solid #ccc;border-radius:10px" />
    <div class="quiz-actions" style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
      <button id="quizCancel" style="border:0;border-radius:10px;padding:8px 14px;background:#eee;cursor:pointer;box-shadow:0 1px 3px var(--shadow);">ã‚„ã‚ã‚‹</button>
      <button id="quizOk" style="border:0;border-radius:10px;padding:8px 14px;background:#cdeccd;color:#145f14;font-weight:700;cursor:pointer;box-shadow:0 1px 3px var(--shadow);">æ±ºå®š</button>
    </div>
  </div>
</div>

  <!-- ã‚¹ãƒ†ã‚£ãƒƒã‚¯ï¼ˆã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ï¼‰ -->
<div id="joypad" class="joypad" aria-label="ã‚¹ãƒ†ã‚£ãƒƒã‚¯" hidden>
  <div class="joy-base"></div>
  <div class="joy-stick"></div>
</div>


<script>
/* ========== ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«/ãŠå•ã„åˆã‚ã›ï¼‰ ========== */
(function(){
  const modals = document.querySelectorAll('.modal-overlay');
  document.getElementById('openProfile')?.addEventListener('click', e=>{ e.preventDefault(); document.getElementById('profileModal').classList.add('active'); });
  document.getElementById('openContact')?.addEventListener('click', e=>{ e.preventDefault(); document.getElementById('contactModal').classList.add('active'); });
  modals.forEach(m=>{
    m.addEventListener('click', e=>{ if(e.target===m) m.classList.remove('active'); });
    m.querySelectorAll('[data-close]').forEach(btn=>btn.addEventListener('click', ()=>m.classList.remove('active')));
  });
})();
</script>

<script>
/* =========================================================
   ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼ˆæ±Ÿæˆ¸ï¼å®¤ç”ºï¼éŒå€‰ï¼æˆ¦å›½ï¼‰
   ========================================================= */
const dataSets = {
  /* ---------- æ±Ÿæˆ¸æ™‚ä»£ ---------- */
  edo: {
    title: "æ±Ÿæˆ¸æ™‚ä»£",
    LS_KEY: "cards_edo_complete_v1",
    chapters: {
      "åˆæœŸ": {
        "1603 ã€‡ã€‡å¹•åºœãŒã¯ã˜ã¾ã‚‹": { text: "å®¶åº·ãŒå°†è»ã«ãªã‚Šã€æ±Ÿæˆ¸ã§å›½ã®ä¸­å¿ƒãŒå‹•ãå‡ºã™ã€‚", icon: "ğŸ¯", year: 1603 },
        "1615 ã€‡ã€‡ã€‡ã€‡ã®é™£":       { text: "å¤§ããªãŸãŸã‹ã„ãŒçµ‚ã‚ã‚Šã€è±Šè‡£ã®æ™‚ä»£ã«å¹•ã€‚", icon: "âš”ï¸", year: 1615 },
        "1635 ã€‡ã€‡ã€‡ã€‡äº¤ä»£":          { text: "å¤§åã¯å›½ã¨æ±Ÿæˆ¸ã‚’è¡Œãæ¥ã™ã‚‹ãã¾ã‚Šã«ã€‚", icon: "ğŸš¶", year: 1635 },
        "1637 å³¶ã€‡ã€‡ãƒ»å¤©ã€‡ã€‡ã®ä¹±":  { text: "ä¹å·ã§å¤§ããªä¸€æ†ãŒèµ·ãã‚‹ã€‚", icon: "ğŸ”¥", year: 1637 },
        "1639 ã€‡ã€‡ã€‡ã€‡ã€‡èˆ¹ã®æ¥èˆªç¦æ­¢": { text: "å¤–å›½èˆ¹ã®å‡ºå…¥ã‚Šã‚’ã—ã‚ã¦ã€äº¤æµã‚’ã›ã„ã’ã‚“ã€‚", icon: "â›µ", year: 1639 },
        "1641 ã€‡ã€‡ã€‡ã§ã®è²¿æ˜“":      { text: "ã‚ªãƒ©ãƒ³ãƒ€å•†é¤¨ãŒé•·å´ã®å‡ºå³¶ã¸ã€‚", icon: "ğŸï¸", year: 1641 },
        "1657 ã€‡ã€‡ã€‡ã€‡ã®å¤§ç«":      { text: "æ±Ÿæˆ¸ã®ç”ºãŒå¤§ç«äº‹ã€‚ç”ºã¥ãã‚Šã‚’ç«‹ã¦ç›´ã™ã€‚", icon: "ğŸ”¥", year: 1657 },
        "1657 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã¸ç§»è»¢":  { text: "éŠéƒ­ãŒæµ…è‰åƒæŸã®æ–°ã—ã„å ´æ‰€ã¸ã€‚", icon: "ğŸ®", year: 1657 }
      },
      "ä¸­æœŸ": {
        "1688 ã€‡ã€‡ã€‡ã€‡æ–‡åŒ–ãŒã•ã‹ãˆã‚‹": { text: "ç”ºäººã®æ–‡åŒ–ãŒèŠ±ã²ã‚‰ãã€‚æ­Œèˆä¼ã‚„æµ®ä¸–çµµãŒäººæ°—ã€‚", icon: "ğŸ­", year: 1688 },
        "1716 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æ”¹é©":         { text: "å‰å®—ãŒãã‚‰ã—ã¨è²¡æ”¿ã‚’ç«‹ã¦ç›´ã™å·¥å¤«ã‚’ã¯ã˜ã‚ã‚‹ã€‚", icon: "ğŸ“œ", year: 1716 },
        "1720 ã€‡ã€‡ã€‡ã€‡ã‚’ã¨ã‚Šã„ã‚Œã‚‹":   { text: "æµ·å¤–ã®å­¦ã³ãŒåºƒãŒã‚Šã€çŸ¥è­˜ãŒãµãˆã‚‹ã€‚", icon: "ğŸ“š", year: 1720 },
        "1720 ã€‡ã€‡ã€‡ã€‡ã€‡ã®ã—ãã¿":     { text: "ç«äº‹ã«ããªãˆã‚‹ç”ºäººã®çµ„ãŒã§ãã‚‹ã€‚", icon: "ğŸš’", year: 1720 },
        "1730 ã€‡ã€‡ã®ãªãŒã‚Œã‚’æ•´ãˆã‚‹":   { text: "å•†ã„ã®ãã¾ã‚Šã‚’ã¨ã¨ã®ãˆã€ç”ºã‚’å…ƒæ°—ã«ã€‚", icon: "ğŸ§º", year: 1730 },
        "1775 ã€‡ã€‡ã€‡ã®æ™‚ä»£":           { text: "å•†ã„ã‚’æ´»ã‹ã™æ”¿æ²»ã§ãŠé‡‘ã®æµã‚Œã‚’ã‚ˆãã™ã‚‹è©¦ã¿ã€‚", icon: "ğŸ’¹", year: 1775 },
        "1783 ã€‡ã€‡ã€‡ã€‡ã®ããã‚“":       { text: "å¯’ã•ã‚„ä¸ä½œã§é£Ÿã¹ç‰©ãŒãŸã‚Šãªããªã‚‹ã€‚", icon: "ğŸŒ¾", year: 1783 }
      },
      "å¹•æœ«": {
        "1787 ã€‡ã€‡ã€‡ã€‡ã®æ”¹é©":         { text: "ãã‚‰ã—ã‚’ã²ãã—ã‚ã€æ•™è‚²ã‚‚å¤§åˆ‡ã«ã™ã‚‹æ–¹é‡ã€‚", icon: "ğŸ“", year: 1787 },
        "1825 ã€‡ã€‡ã€‡ã€‡ã€‡æ‰“æ‰•ä»¤":       { text: "è¿‘ã¥ãå¤–å›½èˆ¹ã‚’è¿½ã„ã¯ã‚‰ã†ãã¾ã‚Šã€‚", icon: "ğŸ“£", year: 1825 },
        "1837 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®ä¹±": { text: "å¤§é˜ªã§äººã³ã¨ã®è‹¦ã—ã•ãŒçˆ†ç™ºã€‚", icon: "âš ï¸", year: 1837 },
        "1841 ã€‡ã€‡ã€‡ã€‡ã®æ”¹é©":           { text: "ç”ºã®æ±ºã¾ã‚Šã‚’è¦‹ç›´ã—ã€ãœã„ãŸãã‚’ãŠã•ãˆã‚‹ã€‚", icon: "ğŸ“", year: 1841 },
        "1853 ã€‡ã€‡ã€‡ã€‡ãŒæ¥ã‚‹":         { text: "ã‚¢ãƒ¡ãƒªã‚«ã®èˆ¹ãŒæµ¦è³€ã«æ¥èˆªã€‚", icon: "â›´ï¸", year: 1853 },
        "1854 ã€‡ã€‡ã€‡æ¡ç´„":             { text: "æ—¥æœ¬ã¯æ¸¯ã‚’é–‹ãã€äº¤æµã‚’ã¯ã˜ã‚ã‚‹ã€‚", icon: "ğŸ¤", year: 1854 },
        "1858 ã€‡ã€‡ã€‡ã€‡ã®æ¡ç´„":         { text: "ã„ãã¤ã‹ã®å›½ã¨ã‚€ã™ã³ã€è²¿æ˜“ãŒåºƒãŒã‚‹ã€‚", icon: "ğŸŒ", year: 1858 },
        "1858 ã€‡ã€‡ã€‡ã€‡ã®å¤§ç„":         { text: "æ„è¦‹ã®ã¡ãŒã„ã§å¤šãã®äººãŒå‡¦ç½°ã•ã‚Œã‚‹ã€‚", icon: "âš–ï¸", year: 1858 },
        "1860 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®å¤‰":   { text: "æ”¿æ²»ã®å¯¾ç«‹ãŒäº‹ä»¶ã«ã€‚", icon: "ğŸ—¡ï¸", year: 1860 },
        "1867 ã€‡ã€‡ã€‡ã€‡å¥‰é‚„":           { text: "æ”¿ï¼ˆã¾ã¤ã‚Šã”ã¨ï¼‰ã‚’æœå»·ã«ãŠè¿”ã—ã€‚", icon: "ğŸ—ï¸", year: 1867 },
        "1868 ã€‡ã€‡ã€‡ã¸":               { text: "æ–°ã—ã„æ™‚ä»£ã®ã‚¹ã‚¿ãƒ¼ãƒˆï¼", icon: "ğŸŒ¸", year: 1868 }
      }
    },
    ruby: {
      "1603 ã€‡ã€‡å¹•åºœãŒã¯ã˜ã¾ã‚‹": "ã€‡ã€‡<ruby>å¹•åºœ<rt>ã°ããµ</rt></ruby>ãŒã¯ã˜ã¾ã‚‹",
      "1615 ã€‡ã€‡ã€‡ã€‡ã®é™£": "ã€‡ã€‡ã€‡ã€‡ã®<ruby>é™£<rt>ã˜ã‚“</rt></ruby>",
      "1635 ã€‡ã€‡ã€‡ã€‡äº¤ä»£": "ã€‡ã€‡ã€‡ã€‡<ruby>äº¤ä»£<rt>ã“ã†ãŸã„</rt></ruby>",
      "1637 å³¶ã€‡ã€‡ãƒ»å¤©ã€‡ã€‡ã®ä¹±": "å³¶ã€‡ã€‡ãƒ»å¤©ã€‡ã€‡ã®<ruby>ä¹±<rt>ã‚‰ã‚“</rt></ruby>",
      "1639 ã€‡ã€‡ã€‡ã€‡ã€‡èˆ¹ã®æ¥èˆªç¦æ­¢": "ã€‡ã€‡ã€‡ã€‡ã€‡<ruby>èˆ¹<rt>ã›ã‚“</rt></ruby>ã®<ruby>æ¥èˆª<rt>ã‚‰ã„ã“ã†</rt></ruby><ruby>ç¦æ­¢<rt>ãã‚“ã—</rt></ruby>",
      "1641 ã€‡ã€‡ã€‡ã§ã®è²¿æ˜“": "ã€‡ã€‡ã€‡ã§ã®<ruby>è²¿æ˜“<rt>ã¼ã†ãˆã</rt></ruby>",
      "1657 ã€‡ã€‡ã€‡ã€‡ã®å¤§ç«": "ã€‡ã€‡ã€‡ã€‡ã®<ruby>å¤§ç«<rt>ãŸã„ã‹</rt></ruby>",
      "1657 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã¸ç§»è»¢": "ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã¸<ruby>ç§»è»¢<rt>ã„ã¦ã‚“</rt></ruby>",
      "1688 ã€‡ã€‡ã€‡ã€‡æ–‡åŒ–ãŒã•ã‹ãˆã‚‹": "ã€‡ã€‡ã€‡ã€‡<ruby>æ–‡åŒ–<rt>ã¶ã‚“ã‹</rt></ruby>ãŒã•ã‹ãˆã‚‹",
      "1716 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æ”¹é©": "ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>æ”¹é©<rt>ã‹ã„ã‹ã</rt></ruby>",
      "1720 ã€‡ã€‡ã€‡ã€‡ã‚’ã¨ã‚Šã„ã‚Œã‚‹": "ã€‡ã€‡ã€‡ã€‡ã‚’ã¨ã‚Šã„ã‚Œã‚‹",
      "1720 ã€‡ã€‡ã€‡ã€‡ã€‡ã®ã—ãã¿": "ã€‡ã€‡ã€‡ã€‡ã€‡ã®ã—ãã¿",
      "1730 ã€‡ã€‡ã®ãªãŒã‚Œã‚’æ•´ãˆã‚‹": "ã€‡ã€‡ã®ãªãŒã‚Œã‚’<ruby>æ•´ãˆã‚‹<rt>ã¨ã¨ã®ãˆã‚‹</rt></ruby>",
      "1775 ã€‡ã€‡ã€‡ã®æ™‚ä»£": "ã€‡ã€‡ã€‡ã®<ruby>æ™‚ä»£<rt>ã˜ã ã„</rt></ruby>",
      "1783 ã€‡ã€‡ã€‡ã€‡ã®ããã‚“": "ã€‡ã€‡ã€‡ã€‡ã®ããã‚“",
      "1787 ã€‡ã€‡ã€‡ã€‡ã®æ”¹é©": "ã€‡ã€‡ã€‡ã€‡ã®<ruby>æ”¹é©<rt>ã‹ã„ã‹ã</rt></ruby>",
      "1825 ã€‡ã€‡ã€‡ã€‡ã€‡æ‰“æ‰•ä»¤": "ã€‡ã€‡ã€‡ã€‡ã€‡<ruby>æ‰“æ‰•ä»¤<rt>ã†ã¡ã¯ã‚‰ã„ã‚Œã„</rt></ruby>",
      "1837 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®ä¹±": "ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>ä¹±<rt>ã‚‰ã‚“</rt></ruby>",
      "1841 ã€‡ã€‡ã€‡ã€‡ã®æ”¹é©": "ã€‡ã€‡ã€‡ã€‡ã®<ruby>æ”¹é©<rt>ã‹ã„ã‹ã</rt></ruby>",
      "1853 ã€‡ã€‡ã€‡ã€‡ãŒæ¥ã‚‹": "ã€‡ã€‡ã€‡ã€‡ãŒ<ruby>æ¥<rt>ã</rt></ruby>ã‚‹",
      "1854 ã€‡ã€‡ã€‡æ¡ç´„": "ã€‡ã€‡ã€‡<ruby>æ¡ç´„<rt>ã˜ã‚‡ã†ã‚„ã</rt></ruby>",
      "1858 ã€‡ã€‡ã€‡ã€‡ã®æ¡ç´„": "ã€‡ã€‡ã€‡ã€‡ã®<ruby>æ¡ç´„<rt>ã˜ã‚‡ã†ã‚„ã</rt></ruby>",
      "1858 ã€‡ã€‡ã€‡ã€‡ã®å¤§ç„": "ã€‡ã€‡ã€‡ã€‡ã®<ruby>å¤§ç„<rt>ãŸã„ã”ã</rt></ruby>",
      "1860 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®å¤‰": "ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>å¤‰<rt>ã¸ã‚“</rt></ruby>",
      "1867 ã€‡ã€‡ã€‡ã€‡å¥‰é‚„": "ã€‡ã€‡ã€‡ã€‡<ruby>å¥‰é‚„<rt>ã»ã†ã‹ã‚“</rt></ruby>",
      "1868 ã€‡ã€‡ã€‡ã¸": "ã€‡ã€‡ã€‡ã¸"
    },
    blanks: {
      "1603 ã€‡ã€‡å¹•åºœãŒã¯ã˜ã¾ã‚‹": ["ãˆã©"],
      "1615 ã€‡ã€‡ã€‡ã€‡ã®é™£": ["ãŠãŠã•ã‹"],
      "1635 ã€‡ã€‡ã€‡ã€‡äº¤ä»£": ["ã•ã‚“ãã‚“"],
      "1637 å³¶ã€‡ã€‡ãƒ»å¤©ã€‡ã€‡ã®ä¹±": ["ã°ã‚‰","ãã•"],
      "1639 ã€‡ã€‡ã€‡ã€‡ã€‡èˆ¹ã®æ¥èˆªç¦æ­¢": ["ã½ã‚‹ã¨ãŒã‚‹"],
      "1641 ã€‡ã€‡ã€‡ã§ã®è²¿æ˜“": ["ã§ã˜ã¾"],
      "1657 ã€‡ã€‡ã€‡ã€‡ã®å¤§ç«": ["ã‚ã„ã‚Œã"],
      "1657 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã¸ç§»è»¢": ["ã—ã‚“ã‚ˆã—ã‚ã‚‰"],
      "1688 ã€‡ã€‡ã€‡ã€‡æ–‡åŒ–ãŒã•ã‹ãˆã‚‹": ["ã’ã‚“ã‚ã"],
      "1716 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æ”¹é©": ["ãã‚‡ã†ã»ã†"],
      "1720 ã€‡ã€‡ã€‡ã€‡ã‚’ã¨ã‚Šã„ã‚Œã‚‹": ["ã‚ˆã†ã—ã‚‡"],
      "1720 ã€‡ã€‡ã€‡ã€‡ã€‡ã®ã—ãã¿": ["ã¾ã¡ã³ã‘ã—"],
      "1730 ã€‡ã€‡ã®ãªãŒã‚Œã‚’æ•´ãˆã‚‹": ["ã‚‚ã®"],
      "1775 ã€‡ã€‡ã€‡ã®æ™‚ä»£": ["ãŸã¬ã¾"],
      "1783 ã€‡ã€‡ã€‡ã€‡ã®ããã‚“": ["ã¦ã‚“ã‚ã„"],
      "1787 ã€‡ã€‡ã€‡ã€‡ã®æ”¹é©": ["ã‹ã‚“ã›ã„"],
      "1825 ã€‡ã€‡ã€‡ã€‡ã€‡æ‰“æ‰•ä»¤": ["ã„ã“ãã›ã‚“"],
      "1837 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®ä¹±": ["ãŠãŠã—ãŠã¸ã„ã¯ã¡ã‚ã†"],
      "1841 ã€‡ã€‡ã€‡ã€‡ã®æ”¹é©": ["ã¦ã‚“ã½ã†"],
      "1853 ã€‡ã€‡ã€‡ã€‡ãŒæ¥ã‚‹": ["ãã‚ãµã­"],
      "1854 ã€‡ã€‡ã€‡æ¡ç´„": ["ã‚ã—ã‚“"],
      "1858 ã€‡ã€‡ã€‡ã€‡ã®æ¡ç´„": ["ã‚ã‚“ã›ã„"],
      "1858 ã€‡ã€‡ã€‡ã€‡ã®å¤§ç„": ["ã‚ã‚“ã›ã„"],
      "1860 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®å¤‰": ["ã•ãã‚‰ã ã‚‚ã‚“ãŒã„"],
      "1867 ã€‡ã€‡ã€‡ã€‡å¥‰é‚„": ["ãŸã„ã›ã„"],
      "1868 ã€‡ã€‡ã€‡ã¸": ["ã‚ã„ã˜"]
    }
  },

  /* ---------- å®¤ç”ºæ™‚ä»£ ---------- */
  muromachi: {
    title: "å®¤ç”ºæ™‚ä»£",
    LS_KEY: "cards_muromachi_complete_v1",
    chapters: {
      "åˆæœŸï¼ˆå—åŒ—æœã€œï¼‰": {
        "1336 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒã¯ã˜ã¾ã‚‹": { text: "è¶³åˆ©æ°ã®å¹•åºœãŒäº¬éƒ½ã§å§‹ã¾ã‚‹ã€‚", icon: "ğŸ¯", year: 1336 },
        "1392 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡çµ±ä¸€":       { text: "å—æœã¨åŒ—æœãŒã²ã¨ã¤ã«ãªã‚‹ã€‚", icon: "ğŸ¤", year: 1392 },
        "1397 ã€‡ã€‡ã€‡ã€‡ãŒå»ºã¦ã‚‰ã‚Œã‚‹":   { text: "ãã‚‰ã³ã‚„ã‹ãªå»ºç‰©ï¼ˆé¹¿è‹‘å¯ºï¼‰ã€‚", icon: "ğŸ¯", year: 1397 },
        "1390 ã€‡ã€‡ã€‡ã€‡æ–‡åŒ–ãŒã•ã‹ãˆã‚‹": { text: "èƒ½ã‚„èŒ¶ã®æ¹¯ãªã©éƒ½ã®æ–‡åŒ–ãŒç™ºå±•ã€‚", icon: "ğŸ­", year: 1390 },
        "1401 ã€‡ã€‡ã€‡ã€‡è²¿æ˜“ãŒã¯ã˜ã¾ã‚‹": { text: "æ˜ã¨ã®å‹˜åˆï¼ˆè¨¼æ˜ï¼‰ã‚’ç”¨ã„ãŸè²¿æ˜“ã€‚", icon: "ğŸ›¶", year: 1401 }
      },
      "ä¸­æœŸï¼ˆæ–‡åŒ–ã¨äº‰ã„ï¼‰": {
        "1439 ã€‡ã€‡ã€‡ã€‡ã€‡ã®ä¹±":         { text: "é–¢æ±ã§å¤§ããªæˆ¦ã„ï¼ˆå°†è»å´ã¨å¯¾ç«‹ï¼‰ã€‚", icon: "âš”ï¸", year: 1439 },
        "1441 ã€‡ã€‡ã€‡ã®ä¹±":             { text: "å°†è»ãŒè¨ãŸã‚Œã‚‹äº‹ä»¶ï¼ˆèµ¤æ¾æ°ã‚‰ï¼‰ã€‚", icon: "âš ï¸", year: 1441 },
        "1467 ã€‡ã€‡ã€‡ã€‡ã®ä¹±":           { text: "äº¬éƒ½ãŒè’å»ƒã€ã®ã¡ã®æˆ¦å›½æ™‚ä»£ã¸ã€‚", icon: "ğŸ”¥", year: 1467 },
        "1485 ã€‡ã€‡ã€‡ã€‡å›½ä¸€æ†":         { text: "äººã³ã¨ãŒå”åŠ›ã—ã¦è‡ªæ²»ï¼ˆå±±åŸå›½ï¼‰ã€‚", icon: "ğŸ›¡ï¸", year: 1485 },
        "1489 ã€‡ã€‡ã€‡ã€‡ãŒå»ºã¦ã‚‰ã‚Œã‚‹":   { text: "é™ã‹ãªç¾ï¼ˆæ…ˆç…§å¯ºãƒ»éŠ€é–£ï¼‰ã€‚", icon: "ğŸ¯", year: 1489 },
        "1493 ã€‡ã€‡ã€‡ã€‡ã®æ”¿å¤‰":         { text: "ç´°å·æ°ã®æ”¿å¤‰ã§æ¨©åŠ›ãŒç§»ã‚‹ã€‚", icon: "ğŸŒ€", year: 1493 }
      },
      "å¾ŒæœŸï¼ˆæˆ¦å›½ã®å…¥å£ï¼‰": {
        "1543 ã€‡ã€‡ã€‡ã€‡ä¼æ¥":           { text: "æ–°ã—ã„é“å…·ãŒæ—¥æœ¬ã¸ï¼ˆé‰„ç ²ï¼‰ã€‚", icon: "ğŸ”«", year: 1543 },
        "1549 ã€‡ã€‡ã€‡ã€‡æ•™ä¼æ¥":         { text: "ã‚­ãƒªã‚¹ãƒˆæ•™ãŒæ—¥æœ¬ã«åºƒãŒã‚‹ã€‚", icon: "â›ª", year: 1549 },
        "1555 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":       { text: "å³å³¶ã®æˆ¦ã„ã€æ­¦å°†ãŒå‹¢åŠ›æ‹¡å¤§ã€‚", icon: "ğŸ—ºï¸", year: 1555 },
        "1573 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒãŠã‚ã‚‹":   { text: "å°†è»è¿½æ”¾ã§å¹•åºœãŒçµ‚ã‚ã‚Šã¸ã€‚", icon: "ğŸŒ…", year: 1573 }
      }
    },
    ruby: {
      "1336 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒã¯ã˜ã¾ã‚‹": "ã€‡ã€‡ã€‡ã€‡<ruby>å¹•åºœ<rt>ã°ããµ</rt></ruby>ãŒã¯ã˜ã¾ã‚‹",
      "1392 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡çµ±ä¸€":       "ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡<ruby>çµ±ä¸€<rt>ã¨ã†ã„ã¤</rt></ruby>",
      "1397 ã€‡ã€‡ã€‡ã€‡ãŒå»ºã¦ã‚‰ã‚Œã‚‹":   "ã€‡ã€‡ã€‡ã€‡ãŒ<ruby>å»º<rt>ãŸ</rt></ruby>ã¦ã‚‰ã‚Œã‚‹",
      "1390 ã€‡ã€‡ã€‡ã€‡æ–‡åŒ–ãŒã•ã‹ãˆã‚‹": "ã€‡ã€‡ã€‡ã€‡<ruby>æ–‡åŒ–<rt>ã¶ã‚“ã‹</rt></ruby>ãŒã•ã‹ãˆã‚‹",
      "1401 ã€‡ã€‡ã€‡ã€‡è²¿æ˜“ãŒã¯ã˜ã¾ã‚‹": "ã€‡ã€‡ã€‡ã€‡<ruby>è²¿æ˜“<rt>ã¼ã†ãˆã</rt></ruby>ãŒã¯ã˜ã¾ã‚‹",
      "1439 ã€‡ã€‡ã€‡ã€‡ã€‡ã®ä¹±":         "ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>ä¹±<rt>ã‚‰ã‚“</rt></ruby>",
      "1441 ã€‡ã€‡ã€‡ã®ä¹±":             "ã€‡ã€‡ã€‡ã®<ruby>ä¹±<rt>ã‚‰ã‚“</rt></ruby>",
      "1467 ã€‡ã€‡ã€‡ã€‡ã®ä¹±":           "ã€‡ã€‡ã€‡ã€‡ã®<ruby>ä¹±<rt>ã‚‰ã‚“</rt></ruby>",
      "1485 ã€‡ã€‡ã€‡ã€‡å›½ä¸€æ†":         "ã€‡ã€‡ã€‡ã€‡<ruby>å›½<rt>ãã«</rt></ruby><ruby>ä¸€æ†<rt>ã„ã£ã</rt></ruby>",
      "1489 ã€‡ã€‡ã€‡ã€‡ãŒå»ºã¦ã‚‰ã‚Œã‚‹":   "ã€‡ã€‡ã€‡ã€‡ãŒ<ruby>å»º<rt>ãŸ</rt></ruby>ã¦ã‚‰ã‚Œã‚‹",
      "1493 ã€‡ã€‡ã€‡ã€‡ã®æ”¿å¤‰":         "ã€‡ã€‡ã€‡ã€‡ã®<ruby>æ”¿å¤‰<rt>ã›ã„ã¸ã‚“</rt></ruby>",
      "1543 ã€‡ã€‡ã€‡ã€‡ä¼æ¥":           "ã€‡ã€‡ã€‡ã€‡<ruby>ä¼æ¥<rt>ã§ã‚“ã‚‰ã„</rt></ruby>",
      "1549 ã€‡ã€‡ã€‡ã€‡æ•™ä¼æ¥":         "ã€‡ã€‡ã€‡ã€‡<ruby>æ•™<rt>ãã‚‡ã†</rt></ruby><ruby>ä¼æ¥<rt>ã§ã‚“ã‚‰ã„</rt></ruby>",
      "1555 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":       "ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>æˆ¦<rt>ãŸãŸã‹</rt></ruby>ã„",
      "1573 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒãŠã‚ã‚‹":   "ã€‡ã€‡ã€‡ã€‡<ruby>å¹•åºœ<rt>ã°ããµ</rt></ruby>ãŒ<ruby>çµ‚<rt>ãŠ</rt></ruby>ã‚ã‚‹"
    },
    blanks: {
      "1336 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒã¯ã˜ã¾ã‚‹": ["ã‚€ã‚ã¾ã¡"],
      "1392 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡çµ±ä¸€":       ["ãªã‚“ã¼ãã¡ã‚‡ã†"],
      "1397 ã€‡ã€‡ã€‡ã€‡ãŒå»ºã¦ã‚‰ã‚Œã‚‹":   ["ãã‚“ã‹ã"],
      "1390 ã€‡ã€‡ã€‡ã€‡æ–‡åŒ–ãŒã•ã‹ãˆã‚‹": ["ããŸã‚„ã¾"],
      "1401 ã€‡ã€‡ã€‡ã€‡è²¿æ˜“ãŒã¯ã˜ã¾ã‚‹": ["ã‹ã‚“ã”ã†"],
      "1439 ã€‡ã€‡ã€‡ã€‡ã€‡ã®ä¹±":         ["ãˆã„ãã‚‡ã†"],
      "1441 ã€‡ã€‡ã€‡ã®ä¹±":             ["ã‹ãã¤"],
      "1467 ã€‡ã€‡ã€‡ã€‡ã®ä¹±":           ["ãŠã†ã«ã‚“"],
      "1485 ã€‡ã€‡ã€‡ã€‡å›½ä¸€æ†":         ["ã‚„ã¾ã—ã‚"],
      "1489 ã€‡ã€‡ã€‡ã€‡ãŒå»ºã¦ã‚‰ã‚Œã‚‹":   ["ãã‚“ã‹ã"],
      "1493 ã€‡ã€‡ã€‡ã€‡ã®æ”¿å¤‰":         ["ã‚ã„ãŠã†"],
      "1543 ã€‡ã€‡ã€‡ã€‡ä¼æ¥":           ["ã¦ã£ã½ã†"],
      "1549 ã€‡ã€‡ã€‡ã€‡æ•™ä¼æ¥":         ["ãã‚Šã™ã¨"],
      "1555 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":       ["ã„ã¤ãã—ã¾"],
      "1573 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒãŠã‚ã‚‹":   ["ã‚€ã‚ã¾ã¡"]
    }
  },

  /* ---------- éŒå€‰æ™‚ä»£ ---------- */
  kamakura: {
    title: "éŒå€‰æ™‚ä»£",
    LS_KEY: "cards_kamakura_complete_v1",
    chapters: {
      "åˆæœŸï¼ˆæºå¹³ã€œå‰µè¨­ï¼‰": {
        "1180 ã€‡ã€‡ã€‡ã€‡åˆæˆ¦ãŒã¯ã˜ã¾ã‚‹": { text: "æºæ°ã¨å¹³æ°ã®å¤§ããªãŸãŸã‹ã„ãŒå§‹ã¾ã‚‹ã€‚", icon: "âš”ï¸", year: 1180 },
        "1185 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":       { text: "å£‡ãƒæµ¦ã§å‹æ•—ãŒæ±ºã¾ã‚‹ã€‚", icon: "ğŸš©", year: 1185 },
        "1185 ã€‡ã€‡ã€‡ãƒ»ã€‡ã€‡ã€‡ã®è¨­ç½®":   { text: "å›½ã”ã¨ã«å®ˆã‚‹äººãƒ»åœŸåœ°ã‚’ãŠã•ã‚ã‚‹äººãŒç½®ã‹ã‚Œã‚‹ã€‚", icon: "ğŸ›¡ï¸", year: 1185 },
        "1185 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒã¯ã˜ã¾ã‚‹": { text: "æ­¦å£«ã®æ”¿æ²»ãŒæœ¬æ ¼ã‚¹ã‚¿ãƒ¼ãƒˆã€‚", icon: "ğŸ¯", year: 1185 },
        "1192 ã€‡ã€‡ã€‡ã€‡ãŒå°†è»ã«":       { text: "ã‚ˆã‚Šã¨ã‚‚ãŒå°†è»ã«ãªã‚‹ã€‚", icon: "ğŸ‘‘", year: 1192 }
      },
      "ä¸­æœŸï¼ˆåŸ·æ¨©æ”¿æ²»ï¼‰": {
        "1203 ã€‡ã€‡ã€‡ã€‡æ”¿æ²»ãŒã¯ã˜ã¾ã‚‹": { text: "åŒ—æ¡æ°ãŒã¾ã¨ã‚ã‚‹æ”¿æ²»ï¼ˆåŸ·æ¨©æ”¿æ²»ï¼‰ã€‚", icon: "ğŸ“œ", year: 1203 },
        "1213 ã€‡ã€‡åˆæˆ¦":               { text: "å’Œç”°æ°ã¨ã®ãŸãŸã‹ã„ã€‚", icon: "âš”ï¸", year: 1213 },
        "1221 ã€‡ã€‡ã€‡ã€‡ã®ä¹±":           { text: "æœå»·ã¨ã®å¤§ããªå¯¾ç«‹ï¼ˆæ‰¿ä¹…ã®ä¹±ï¼‰ã€‚", icon: "âš ï¸", year: 1221 },
        "1232 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ãŒå®šã¾ã‚‹": { text: "æ­¦å£«ã®ãƒ«ãƒ¼ãƒ«ï¼ˆå¾¡æˆæ•—å¼ç›®ï¼‰ãŒã§ãã‚‹ã€‚", icon: "ğŸ“–", year: 1232 },
        "1247 ã€‡ã€‡ã€‡åˆæˆ¦":             { text: "æœ‰åŠ›æ­¦å£«ã®ã‚ã‚‰ãã„ï¼ˆå®æ²»åˆæˆ¦ï¼‰ã€‚", icon: "ğŸ›¡ï¸", year: 1247 },
        "1252 ã€‡ã€‡ã€‡ã€‡ãŒã§ãã‚‹":       { text: "éŒå€‰å¤§ä»ãŒã¤ãã‚‰ã‚Œã‚‹ã€‚", icon: "ğŸ—¿", year: 1252 }
      },
      "å¾ŒæœŸï¼ˆå…ƒå¯‡ã€œæ»…äº¡ï¼‰": {
        "1274 ã€‡ã€‡ã€‡ã€‡ã®å½¹":           { text: "å…ƒãŒæ”»ã‚ã¦ãã‚‹ï¼ˆæ–‡æ°¸ã®å½¹ï¼‰ã€‚", icon: "â›´ï¸", year: 1274 },
        "1281 ã€‡ã€‡ã€‡ã€‡ã®å½¹":           { text: "ãµãŸãŸã³å…ƒãŒæ”»ã‚ã‚‹ï¼ˆå¼˜å®‰ã®å½¹ï¼‰ã€‚", icon: "â›´ï¸", year: 1281 },
        "1297 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ãŒå‡ºã‚‹":     { text: "å€Ÿé‡‘ã‚’ã‚†ã‚‹ã™å‘½ä»¤ï¼ˆå¾³æ”¿ä»¤ï¼‰ã€‚", icon: "ğŸ“¢", year: 1297 },
        "1305 ã€‡ã€‡ã€‡ã€‡é¨’å‹•":           { text: "æœ‰åŠ›è€…ã©ã†ã—ã®å¯¾ç«‹ï¼ˆéœœæœˆé¨’å‹•ï¼‰ã€‚", icon: "ğŸŒªï¸", year: 1305 },
        "1331 ã€‡ã€‡ã€‡ã€‡ã®ä¹±":           { text: "æœå»·ãŒãŸã¡ã‚ãŒã‚‹ï¼ˆå…ƒå¼˜ã®ä¹±ï¼‰ã€‚", icon: "âš ï¸", year: 1331 },
        "1333 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒã»ã‚ã¶":   { text: "éŒå€‰å¹•åºœãŒçµ‚ã‚ã‚‹ã€‚", icon: "ğŸŒ…", year: 1333 }
      },
      "æ–‡åŒ–ï¼ˆæ–°ã—ã„ä»æ•™ï¼‰": {
        "1175 ã€‡ã€‡ã€‡ã€‡å®—ãŒåºƒã¾ã‚‹":     { text: "æ³•ç„¶ã®æ•™ãˆï¼ˆæµ„åœŸå®—ï¼‰ã€‚", icon: "ğŸ™", year: 1175 },
        "1191 ã€‡ã€‡ã€‡ã€‡å®—ãŒä¼ã‚ã‚‹":     { text: "æ „è¥¿ã®æ•™ãˆï¼ˆè‡¨æ¸ˆå®—ï¼‰ã€‚", icon: "ğŸ§˜", year: 1191 },
        "1224 ã€‡ã€‡ã€‡ã€‡çœŸå®—ãŒåºƒã¾ã‚‹":   { text: "è¦ªé¸ã®æ•™ãˆï¼ˆæµ„åœŸçœŸå®—ï¼‰ã€‚", icon: "ğŸ™", year: 1224 },
        "1227 ã€‡ã€‡ã€‡å®—ãŒåºƒã¾ã‚‹":       { text: "ä¸€éã®æ•™ãˆï¼ˆæ™‚å®—ï¼‰ã€‚", icon: "ğŸ™", year: 1227 },
        "1247 ã€‡ã€‡ã€‡ã€‡å®—ãŒåºƒã¾ã‚‹":     { text: "é“å…ƒã®æ•™ãˆï¼ˆæ›¹æ´å®—ï¼‰ã€‚", icon: "ğŸ§˜", year: 1247 },
        "1253 ã€‡ã€‡ã€‡ã€‡å®—ãŒåºƒã¾ã‚‹":     { text: "æ—¥è“®ã®æ•™ãˆï¼ˆæ—¥è“®å®—ï¼‰ã€‚", icon: "ğŸ•Šï¸", year: 1253 }
      }
    },
    ruby: {
      "1180 ã€‡ã€‡ã€‡ã€‡åˆæˆ¦ãŒã¯ã˜ã¾ã‚‹": "ã€‡ã€‡ã€‡ã€‡<ruby>åˆæˆ¦<rt>ã‹ã£ã›ã‚“</rt></ruby>ãŒã¯ã˜ã¾ã‚‹",
      "1185 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":       "ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>æˆ¦<rt>ãŸãŸã‹</rt></ruby>ã„",
      "1185 ã€‡ã€‡ã€‡ãƒ»ã€‡ã€‡ã€‡ã®è¨­ç½®":   "ã€‡ã€‡ã€‡ãƒ»ã€‡ã€‡ã€‡ã®<ruby>è¨­ç½®<rt>ã›ã£ã¡</rt></ruby>",
      "1185 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒã¯ã˜ã¾ã‚‹": "ã€‡ã€‡ã€‡ã€‡<ruby>å¹•åºœ<rt>ã°ããµ</rt></ruby>ãŒã¯ã˜ã¾ã‚‹",
      "1192 ã€‡ã€‡ã€‡ã€‡ãŒå°†è»ã«":       "ã€‡ã€‡ã€‡ã€‡ãŒ<ruby>å°†è»<rt>ã—ã‚‡ã†ãã‚“</rt></ruby>ã«",
      "1203 ã€‡ã€‡ã€‡ã€‡æ”¿æ²»ãŒã¯ã˜ã¾ã‚‹": "ã€‡ã€‡ã€‡ã€‡<ruby>æ”¿æ²»<rt>ã›ã„ã˜</rt></ruby>ãŒã¯ã˜ã¾ã‚‹",
      "1213 ã€‡ã€‡åˆæˆ¦":               "ã€‡ã€‡<ruby>åˆæˆ¦<rt>ã‹ã£ã›ã‚“</rt></ruby>",
      "1221 ã€‡ã€‡ã€‡ã€‡ã®ä¹±":           "ã€‡ã€‡ã€‡ã€‡ã®<ruby>ä¹±<rt>ã‚‰ã‚“</rt></ruby>",
      "1232 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ãŒå®šã¾ã‚‹": "ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ãŒ<ruby>å®š<rt>ã•ã </rt></ruby>ã¾ã‚‹",
      "1247 ã€‡ã€‡ã€‡åˆæˆ¦":             "ã€‡ã€‡ã€‡<ruby>åˆæˆ¦<rt>ã‹ã£ã›ã‚“</rt></ruby>",
      "1252 ã€‡ã€‡ã€‡ã€‡ãŒã§ãã‚‹":       "ã€‡ã€‡ã€‡ã€‡ãŒã§ãã‚‹",
      "1274 ã€‡ã€‡ã€‡ã€‡ã®å½¹":           "ã€‡ã€‡ã€‡ã€‡ã®<ruby>å½¹<rt>ãˆã</rt></ruby>",
      "1281 ã€‡ã€‡ã€‡ã€‡ã®å½¹":           "ã€‡ã€‡ã€‡ã€‡ã®<ruby>å½¹<rt>ãˆã</rt></ruby>",
      "1297 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ãŒå‡ºã‚‹":     "ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ãŒ<ruby>å‡º<rt>ã§</rt></ruby>ã‚‹",
      "1305 ã€‡ã€‡ã€‡ã€‡é¨’å‹•":           "ã€‡ã€‡ã€‡ã€‡<ruby>é¨’å‹•<rt>ãã†ã©ã†</rt></ruby>",
      "1331 ã€‡ã€‡ã€‡ã€‡ã®ä¹±":           "ã€‡ã€‡ã€‡ã€‡ã®<ruby>ä¹±<rt>ã‚‰ã‚“</rt></ruby>",
      "1333 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒã»ã‚ã¶":   "ã€‡ã€‡ã€‡ã€‡<ruby>å¹•åºœ<rt>ã°ããµ</rt></ruby>ãŒã»ã‚ã¶",
      "1175 ã€‡ã€‡ã€‡ã€‡å®—ãŒåºƒã¾ã‚‹":     "ã€‡ã€‡ã€‡ã€‡<ruby>å®—<rt>ã—ã‚…ã†</rt></ruby>ãŒåºƒã¾ã‚‹",
      "1191 ã€‡ã€‡ã€‡ã€‡å®—ãŒä¼ã‚ã‚‹":     "ã€‡ã€‡ã€‡ã€‡<ruby>å®—<rt>ã—ã‚…ã†</rt></ruby>ãŒ<ruby>ä¼<rt>ã¤ãŸ</rt></ruby>ã‚ã‚‹",
      "1224 ã€‡ã€‡ã€‡ã€‡çœŸå®—ãŒåºƒã¾ã‚‹":   "ã€‡ã€‡ã€‡ã€‡<ruby>çœŸå®—<rt>ã—ã‚“ã—ã‚…ã†</rt></ruby>ãŒåºƒã¾ã‚‹",
      "1227 ã€‡ã€‡ã€‡å®—ãŒåºƒã¾ã‚‹":       "ã€‡ã€‡ã€‡<ruby>å®—<rt>ã—ã‚…ã†</rt></ruby>ãŒåºƒã¾ã‚‹",
      "1247 ã€‡ã€‡ã€‡ã€‡å®—ãŒåºƒã¾ã‚‹":     "ã€‡ã€‡ã€‡ã€‡<ruby>å®—<rt>ã—ã‚…ã†</rt></ruby>ãŒåºƒã¾ã‚‹",
      "1253 ã€‡ã€‡ã€‡ã€‡å®—ãŒåºƒã¾ã‚‹":     "ã€‡ã€‡ã€‡ã€‡<ruby>å®—<rt>ã—ã‚…ã†</rt></ruby>ãŒåºƒã¾ã‚‹"
    },
    blanks: {
      "1180 ã€‡ã€‡ã€‡ã€‡åˆæˆ¦ãŒã¯ã˜ã¾ã‚‹": ["ã’ã‚“ãºã„"],
      "1185 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":       ["ãŸã‚“ã®ã†ã‚‰"],
      "1185 ã€‡ã€‡ã€‡ãƒ»ã€‡ã€‡ã€‡ã®è¨­ç½®":   ["ã—ã‚…ã”","ã˜ã¨ã†"],
      "1185 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒã¯ã˜ã¾ã‚‹": ["ã‹ã¾ãã‚‰"],
      "1192 ã€‡ã€‡ã€‡ã€‡ãŒå°†è»ã«":       ["ã‚ˆã‚Šã¨ã‚‚"],
      "1203 ã€‡ã€‡ã€‡ã€‡æ”¿æ²»ãŒã¯ã˜ã¾ã‚‹": ["ã—ã£ã‘ã‚“"],
      "1213 ã€‡ã€‡åˆæˆ¦":               ["ã‚ã "],
      "1221 ã€‡ã€‡ã€‡ã€‡ã®ä¹±":           ["ã˜ã‚‡ã†ãã‚…ã†"],
      "1232 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ãŒå®šã¾ã‚‹": ["ã”ã›ã„ã°ã„ã—ãã‚‚ã"],
      "1247 ã€‡ã€‡ã€‡åˆæˆ¦":             ["ã»ã†ã˜"],
      "1252 ã€‡ã€‡ã€‡ã€‡ãŒã§ãã‚‹":       ["ã ã„ã¶ã¤"],
      "1274 ã€‡ã€‡ã€‡ã€‡ã®å½¹":           ["ã¶ã‚“ãˆã„"],
      "1281 ã€‡ã€‡ã€‡ã€‡ã®å½¹":           ["ã“ã†ã‚ã‚“"],
      "1297 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ãŒå‡ºã‚‹":     ["ã¨ãã›ã„ã‚Œã„"],
      "1305 ã€‡ã€‡ã€‡ã€‡é¨’å‹•":           ["ã—ã‚‚ã¤ã"],
      "1331 ã€‡ã€‡ã€‡ã€‡ã®ä¹±":           ["ã’ã‚“ã“ã†"],
      "1333 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒã»ã‚ã¶":   ["ã‹ã¾ãã‚‰"],
      "1175 ã€‡ã€‡ã€‡ã€‡å®—ãŒåºƒã¾ã‚‹":     ["ã˜ã‚‡ã†ã©"],
      "1191 ã€‡ã€‡ã€‡ã€‡å®—ãŒä¼ã‚ã‚‹":     ["ã‚Šã‚“ã–ã„"],
      "1224 ã€‡ã€‡ã€‡ã€‡çœŸå®—ãŒåºƒã¾ã‚‹":   ["ã˜ã‚‡ã†ã©"],
      "1227 ã€‡ã€‡ã€‡å®—ãŒåºƒã¾ã‚‹":       ["ã˜ã—ã‚…ã†"],
      "1247 ã€‡ã€‡ã€‡ã€‡å®—ãŒåºƒã¾ã‚‹":     ["ãã†ã¨ã†"],
      "1253 ã€‡ã€‡ã€‡ã€‡å®—ãŒåºƒã¾ã‚‹":     ["ã«ã¡ã‚Œã‚“"]
    }
  },

  /* ---------- æˆ¦å›½æ™‚ä»£ ---------- */
  sengoku: {
    title: "æˆ¦å›½æ™‚ä»£",
    LS_KEY: "cards_sengoku_complete_v1",
    chapters: {
      "å‰æœŸï¼ˆæˆ¦ä¹±ã®ã¯ã˜ã¾ã‚Šï¼‰": {
        "1467 ã€‡ã€‡ã€‡ã€‡ã®ä¹±":                { text: "äº¬éƒ½ã§å¤§ããªæˆ¦ã„ãŒã¯ã˜ã¾ã‚Šã€å…¨å›½ã«åºƒãŒã‚‹ã€‚", icon: "ğŸ”¥", year: 1467 },
        "1485 ã€‡ã€‡ã€‡ã€‡å›½ä¸€æ†":              { text: "äººã³ã¨ãŒå”åŠ›ã—ã¦è‡ªæ²»ï¼ˆå±±åŸå›½ï¼‰ã€‚", icon: "ğŸ›¡ï¸", year: 1485 }
      },
      "ç¾¤é›„å‰²æ‹ ": {
        "1543 ã€‡ã€‡ã€‡ã€‡ä¼æ¥":                { text: "æ–°ã—ã„æ­¦å™¨ãŒä¼ã‚ã‚‹ï¼ˆé‰„ç ²ï¼‰ã€‚", icon: "ğŸ”«", year: 1543 },
        "1549 ã€‡ã€‡ã€‡ã€‡æ•™ä¼æ¥":              { text: "ã‚­ãƒªã‚¹ãƒˆæ•™ãŒæ—¥æœ¬ã«åºƒãŒã‚‹ã€‚", icon: "â›ª", year: 1549 },
        "1555 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":            { text: "å³å³¶ã®æˆ¦ã„ã€æ­¦å°†ãŒå‹¢åŠ›æ‹¡å¤§ã€‚", icon: "ğŸ—ºï¸", year: 1555 },
        "1560 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":            { text: "æ¡¶ç‹­é–“ã®æˆ¦ã„ã€å¥‡è¥²ã§ã‹ã¤ã€‚", icon: "âš”ï¸", year: 1560 },
        "1561 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":          { text: "å·ä¸­å³¶ã®æˆ¦ã„ã€åå°†ã©ã†ã—ãŒæ¿€çªã€‚", icon: "âš”ï¸", year: 1561 },
        "1567 ã€‡ã€‡ã«æ”¹åï¼ˆç¨²è‘‰å±±â†’ã€œï¼‰":    { text: "åŸä¸‹ç”ºã®åã‚’ã‚ã‚‰ãŸã‚ã‚‹ï¼ˆå²é˜œï¼‰ã€‚", icon: "ğŸ¯", year: 1567 },
        "1568 ã€‡ã€‡ã€‡ã€‡ãŒäº¬éƒ½ã«å…¥ã‚‹":        { text: "éƒ½ã‚’ãŠã•ãˆã¦å¤©ä¸‹ã¸é€²ã‚€ã€‚", icon: "ğŸ¯", year: 1568 }
      },
      "çµ±ä¸€ã¸": {
        "1570 ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":              { text: "å§‰å·ã®æˆ¦ã„ã€‚", icon: "âš”ï¸", year: 1570 },
        "1571 ã€‡ã€‡ã€‡ã€‡ã€‡ç„¼ãè¨ã¡":          { text: "æ¯”å¡å±±ã‚’æ”»ã‚ã‚‹ã€‚", icon: "ğŸ”¥", year: 1571 },
        "1573 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒãŠã‚ã‚‹":        { text: "å®¤ç”ºå¹•åºœã®çµ‚ã‚ã‚Šã€‚", icon: "ğŸŒ…", year: 1573 },
        "1575 ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":              { text: "é•·ç¯ ã®æˆ¦ã„ã€é‰„ç ²ã§å‹ã¤ã€‚", icon: "ğŸ”«", year: 1575 },
        "1576 ã€‡ã€‡ã€‡åŸã‚’ç¯‰ã":              { text: "å®‰åœŸåŸã‚’ã¤ãã‚‹ã€‚", icon: "ğŸ°", year: 1576 },
        "1582 ã€‡ã€‡ã€‡ã€‡ã€‡ã®å¤‰":              { text: "æœ¬èƒ½å¯ºã®å¤‰ã€‚", icon: "ğŸ—¡ï¸", year: 1582 },
        "1582 ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":              { text: "å±±å´ã®æˆ¦ã„ã€‚", icon: "âš”ï¸", year: 1582 },
        "1583 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":            { text: "è³¤ãƒ¶å²³ã®æˆ¦ã„ã€‚", icon: "âš”ï¸", year: 1583 },
        "1584 ã€‡ã€‡ã€‡ãƒ»ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":      { text: "å°ç‰§ãƒ»é•·ä¹…æ‰‹ã®æˆ¦ã„ã€‚", icon: "âš”ï¸", year: 1584 },
        "1585 ã€‡ã€‡ã€‡ã€‡ã«ãªã‚‹":              { text: "é–¢ç™½ã«ãªã‚‹ã€‚", icon: "ğŸ–ï¸", year: 1585 },
        "1587 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã‚’å¹³å®š":          { text: "ä¹å·ã‚’ãŠã•ã‚ã‚‹ã€‚", icon: "ğŸ—¾", year: 1587 },
        "1588 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ä»¤":            { text: "åˆ€ç‹©ä»¤ã‚’å‡ºã™ã€‚", icon: "ğŸ“¢", year: 1588 },
        "1590 ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":              { text: "å°ç”°åŸã®æˆ¦ã„ã€‚", icon: "âš”ï¸", year: 1590 },
        "1591 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ãŒå‡ºã‚‹":      { text: "èº«åˆ†çµ±åˆ¶ä»¤ã‚’å‡ºã™ã€‚", icon: "ğŸ“œ", year: 1591 },
        "1592 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®å½¹":          { text: "æœé®®ã¸å‡ºå…µï¼ˆæ–‡ç¦„ã®å½¹ï¼‰ã€‚", icon: "â›´ï¸", year: 1592 },
        "1597 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®å½¹":        { text: "ãµãŸãŸã³å‡ºå…µï¼ˆæ…¶é•·ã®å½¹ï¼‰ã€‚", icon: "â›´ï¸", year: 1597 },
        "1598 ã€‡ã€‡ã€‡ã€‡ãŒãªããªã‚‹":          { text: "ç§€å‰ãŒäº¡ããªã‚‹ã€‚", icon: "ğŸ•Šï¸", year: 1598 },
        "1600 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":            { text: "é–¢ãƒ¶åŸã®æˆ¦ã„ã€‚", icon: "âš”ï¸", year: 1600 }
      },
      "æ”¿ç­–ã¨ç”ºã¥ãã‚Š": {
        "1577 ã€‡ã€‡ã€‡ã€‡ãƒ»ã€‡ã€‡ã€‡ã‚’ã™ã™ã‚ã‚‹":  { text: "æ¥½å¸‚ãƒ»æ¥½åº§ã‚’ã™ã™ã‚ã€å•†ã„ãŒæ´»ç™ºã«ã€‚", icon: "ğŸ›ï¸", year: 1577 },
        "1582 ã€‡ã€‡ã€‡ã€‡æ¤œåœ°ãŒã™ã™ã‚€":        { text: "ç”°ã‚“ã¼ã®åºƒã•ã‚’ã¯ã‹ã‚Šã€ç¨ã‚’æ±ºã‚ã‚‹ï¼ˆå¤ªé–¤æ¤œåœ°ï¼‰ã€‚", icon: "ğŸ“", year: 1582 },
        "1583 ã€‡ã€‡ã€‡ã€‡åŸã‚’ç¯‰ã":            { text: "å¤§é˜ªåŸã‚’ç¯‰ãã€‚", icon: "ğŸ¯", year: 1583 }
      }
    },
    ruby: {
      "1467 ã€‡ã€‡ã€‡ã€‡ã®ä¹±":                 "ã€‡ã€‡ã€‡ã€‡ã®<ruby>ä¹±<rt>ã‚‰ã‚“</rt></ruby>",
      "1485 ã€‡ã€‡ã€‡ã€‡å›½ä¸€æ†":               "ã€‡ã€‡ã€‡ã€‡<ruby>å›½<rt>ãã«</rt></ruby><ruby>ä¸€æ†<rt>ã„ã£ã</rt></ruby>",
      "1543 ã€‡ã€‡ã€‡ã€‡ä¼æ¥":                 "ã€‡ã€‡ã€‡ã€‡<ruby>ä¼æ¥<rt>ã§ã‚“ã‚‰ã„</rt></ruby>",
      "1549 ã€‡ã€‡ã€‡ã€‡æ•™ä¼æ¥":               "ã€‡ã€‡ã€‡ã€‡<ruby>æ•™<rt>ãã‚‡ã†</rt></ruby><ruby>ä¼æ¥<rt>ã§ã‚“ã‚‰ã„</rt></ruby>",
      "1555 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":             "ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>æˆ¦<rt>ãŸãŸã‹</rt></ruby>ã„",
      "1560 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":             "ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>æˆ¦<rt>ãŸãŸã‹</rt></ruby>ã„",
      "1561 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":           "ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>æˆ¦<rt>ãŸãŸã‹</rt></ruby>ã„",
      "1567 ã€‡ã€‡ã«æ”¹åï¼ˆç¨²è‘‰å±±â†’ã€œï¼‰":     "ã€‡ã€‡ã«<ruby>æ”¹å<rt>ã‹ã„ã‚ã„</rt></ruby>ï¼ˆ<ruby>ç¨²è‘‰å±±<rt>ã„ãªã°ã‚„ã¾</rt></ruby>â†’ã€œï¼‰",
      "1568 ã€‡ã€‡ã€‡ã€‡ãŒäº¬éƒ½ã«å…¥ã‚‹":         "ã€‡ã€‡ã€‡ã€‡ãŒ<ruby>äº¬éƒ½<rt>ãã‚‡ã†ã¨</rt></ruby>ã«<ruby>å…¥<rt>ã¯ã„</rt></ruby>ã‚‹",
      "1570 ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":               "ã€‡ã€‡ã€‡ã€‡ã®<ruby>æˆ¦<rt>ãŸãŸã‹</rt></ruby>ã„",
      "1571 ã€‡ã€‡ã€‡ã€‡ã€‡ç„¼ãè¨ã¡":           "ã€‡ã€‡ã€‡ã€‡ã€‡<ruby>ç„¼<rt>ã‚„</rt></ruby>ã<ruby>è¨<rt>ã†</rt></ruby>ã¡",
      "1573 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒãŠã‚ã‚‹":         "ã€‡ã€‡ã€‡ã€‡<ruby>å¹•åºœ<rt>ã°ããµ</rt></ruby>ãŒ<ruby>çµ‚<rt>ãŠ</rt></ruby>ã‚ã‚‹",
      "1575 ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":               "ã€‡ã€‡ã€‡ã€‡ã®<ruby>æˆ¦<rt>ãŸãŸã‹</rt></ruby>ã„",
      "1576 ã€‡ã€‡ã€‡åŸã‚’ç¯‰ã":               "ã€‡ã€‡ã€‡<ruby>åŸ<rt>ã˜ã‚‡ã†</rt></ruby>ã‚’<ruby>ç¯‰<rt>ããš</rt></ruby>ã",
      "1582 ã€‡ã€‡ã€‡ã€‡ã€‡ã®å¤‰":               "ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>å¤‰<rt>ã¸ã‚“</rt></ruby>",
      "1582 ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":               "ã€‡ã€‡ã€‡ã€‡ã®<ruby>æˆ¦<rt>ãŸãŸã‹</rt></ruby>ã„",
      "1583 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":             "ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>æˆ¦<rt>ãŸãŸã‹</rt></ruby>ã„",
      "1584 ã€‡ã€‡ã€‡ãƒ»ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":       "ã€‡ã€‡ã€‡ãƒ»ã€‡ã€‡ã€‡ã€‡ã®<ruby>æˆ¦<rt>ãŸãŸã‹</rt></ruby>ã„",
      "1585 ã€‡ã€‡ã€‡ã€‡ã«ãªã‚‹":               "ã€‡ã€‡ã€‡ã€‡ã«<ruby>æˆ<rt>ãª</rt></ruby>ã‚‹",
      "1587 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã‚’å¹³å®š":           "ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã‚’<ruby>å¹³å®š<rt>ã¸ã„ã¦ã„</rt></ruby>",
      "1588 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ä»¤":             "ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡<ruby>ä»¤<rt>ã‚Œã„</rt></ruby>",
      "1590 ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":               "ã€‡ã€‡ã€‡ã€‡ã®<ruby>æˆ¦<rt>ãŸãŸã‹</rt></ruby>ã„",
      "1591 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ãŒå‡ºã‚‹":       "ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ãŒ<ruby>å‡º<rt>ã§</rt></ruby>ã‚‹",
      "1592 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®å½¹":           "ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>å½¹<rt>ãˆã</rt></ruby>",
      "1597 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®å½¹":         "ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>å½¹<rt>ãˆã</rt></ruby>",
      "1598 ã€‡ã€‡ã€‡ã€‡ãŒãªããªã‚‹":           "ã€‡ã€‡ã€‡ã€‡ãŒ<ruby>äº¡<rt>ãª</rt></ruby>ããªã‚‹",
      "1600 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":             "ã€‡ã€‡ã€‡ã€‡ã€‡ã®<ruby>æˆ¦<rt>ãŸãŸã‹</rt></ruby>ã„",
      "1577 ã€‡ã€‡ã€‡ã€‡ãƒ»ã€‡ã€‡ã€‡ã‚’ã™ã™ã‚ã‚‹":   "ã€‡ã€‡ã€‡ã€‡ãƒ»ã€‡ã€‡ã€‡ã‚’<ruby>å‹§<rt>ã™ã™</rt></ruby>ã‚ã‚‹",
      "1582 ã€‡ã€‡ã€‡ã€‡æ¤œåœ°ãŒã™ã™ã‚€":         "ã€‡ã€‡ã€‡ã€‡<ruby>æ¤œåœ°<rt>ã‘ã‚“ã¡</rt></ruby>ãŒã™ã™ã‚€",
      "1583 ã€‡ã€‡ã€‡ã€‡åŸã‚’ç¯‰ã":             "ã€‡ã€‡ã€‡ã€‡<ruby>åŸ<rt>ã˜ã‚‡ã†</rt></ruby>ã‚’<ruby>ç¯‰<rt>ããš</rt></ruby>ã"
    },
    blanks: {
      "1467 ã€‡ã€‡ã€‡ã€‡ã®ä¹±":                ["ãŠã†ã«ã‚“"],
      "1485 ã€‡ã€‡ã€‡ã€‡å›½ä¸€æ†":              ["ã‚„ã¾ã—ã‚"],
      "1543 ã€‡ã€‡ã€‡ã€‡ä¼æ¥":                ["ã¦ã£ã½ã†"],
      "1549 ã€‡ã€‡ã€‡ã€‡æ•™ä¼æ¥":              ["ãã‚Šã™ã¨"],
      "1555 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":            ["ã„ã¤ãã—ã¾"],
      "1560 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":            ["ãŠã‘ã¯ã–ã¾"],
      "1561 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":          ["ã‹ã‚ãªã‹ã˜ã¾"],
      "1567 ã€‡ã€‡ã«æ”¹åï¼ˆç¨²è‘‰å±±â†’ã€œï¼‰":    ["ããµ"],
      "1568 ã€‡ã€‡ã€‡ã€‡ãŒäº¬éƒ½ã«å…¥ã‚‹":        ["ã®ã¶ãªãŒ"],
      "1570 ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":              ["ã‚ã­ãŒã‚"],
      "1571 ã€‡ã€‡ã€‡ã€‡ã€‡ç„¼ãè¨ã¡":          ["ã²ãˆã„ã–ã‚“"],
      "1573 ã€‡ã€‡ã€‡ã€‡å¹•åºœãŒãŠã‚ã‚‹":        ["ã‚€ã‚ã¾ã¡"],
      "1575 ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":              ["ãªãŒã—ã®"],
      "1576 ã€‡ã€‡ã€‡åŸã‚’ç¯‰ã":              ["ã‚ã¥ã¡"],
      "1582 ã€‡ã€‡ã€‡ã€‡ã€‡ã®å¤‰":              ["ã»ã‚“ã®ã†ã˜"],
      "1582 ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":              ["ã‚„ã¾ã–ã"],
      "1583 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":            ["ã—ãšãŒãŸã‘"],
      "1584 ã€‡ã€‡ã€‡ãƒ»ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":      ["ã“ã¾ã","ãªãŒãã¦"],
      "1585 ã€‡ã€‡ã€‡ã€‡ã«ãªã‚‹":              ["ã‹ã‚“ã±ã"],
      "1587 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã‚’å¹³å®š":          ["ãã‚…ã†ã—ã‚…ã†"],
      "1588 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ä»¤":            ["ã‹ãŸãªãŒã‚Šã‚Œã„"],
      "1590 ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":              ["ãŠã ã‚ã‚‰"],
      "1591 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ãŒå‡ºã‚‹":      ["ã¿ã¶ã‚“ã¨ã†ã›ã„ã‚Œã„"],
      "1592 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®å½¹":          ["ã¶ã‚“ã‚ãã®ãˆã"],
      "1597 ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ã®å½¹":        ["ã‘ã„ã¡ã‚‡ã†ã®ãˆã"],
      "1598 ã€‡ã€‡ã€‡ã€‡ãŒãªããªã‚‹":          ["ã²ã§ã‚ˆã—"],
      "1600 ã€‡ã€‡ã€‡ã€‡ã€‡ã®æˆ¦ã„":            ["ã›ããŒã¯ã‚‰"],
      "1577 ã€‡ã€‡ã€‡ã€‡ãƒ»ã€‡ã€‡ã€‡ã‚’ã™ã™ã‚ã‚‹":  ["ã‚‰ãã„ã¡","ã‚‰ãã–"],
      "1582 ã€‡ã€‡ã€‡ã€‡æ¤œåœ°ãŒã™ã™ã‚€":        ["ãŸã„ã“ã†"],
      "1583 ã€‡ã€‡ã€‡ã€‡åŸã‚’ç¯‰ã":            ["ãŠãŠã•ã‹"]
    }
  }
};
</script>

<script>
/* ========= ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆUI/çŠ¶æ…‹ç®¡ç†ï¼‰ ========= */
function onlyHiraAndSep(s){ return /^[\u3041-\u3096\sãƒ»,ï¼Œã€/ï¼]+$/.test(s); }
function splitTokens(ans){ let s=ans.replace(/[ãƒ»,ï¼Œã€/ï¼]+/g,' ').replace(/\s+/g,' ').trim();return s? s.split(' '):[]; }
function normalizeTokens(arr){ return arr.map(s=>s.replace(/\s+/g,'').trim()); }

const eraSelectEl     = document.getElementById("eraSelect");
const chapterFilterEl = document.getElementById("chapterFilter");
const cardsWrap       = document.getElementById("cards");
const infoBoxEl       = document.getElementById("info");
const moneyEl         = document.getElementById("moneyValue");
const zukanPanelEl    = document.getElementById("zukanPanel");
const zukanBtnEl      = document.getElementById("zukanBtn");
const closeZukanEl    = document.getElementById("closeZukan");
const resetBtnEl      = document.getElementById("resetBtn");
const openShopBtnEl   = document.getElementById("openShopBtn");
const shopOverlayEl   = document.getElementById("shopOverlay");
const shopCloseEl     = document.getElementById("shopClose");
const shopGridEl      = document.getElementById("shopGrid");

/* ã‚¹ãƒãƒ›HUD */
const placeHud  = document.getElementById("placeHud");
const btnRotate = document.getElementById("btnRotate");
const btnCancel = document.getElementById("btnCancel");

/* é€²æ—ï¼†æ‰€æŒé‡‘ */
const COLS = 30, ROWS = 18;
let currentEra = eraSelectEl ? eraSelectEl.value : "edo";
let gotCards   = {};
let money      = 0;
let cityBuildings = []; // [{id,type,x,y,rot}...]

function persist(){
  try{
    localStorage.setItem(dataSets[currentEra].LS_KEY, JSON.stringify(gotCards));
    localStorage.setItem("money_v1", String(money));
    localStorage.setItem("city_v1", JSON.stringify(cityBuildings));
  }catch(e){}
}
function loadProgress(){
  try{ gotCards = JSON.parse(localStorage.getItem(dataSets[currentEra].LS_KEY) || "{}"); }catch{ gotCards = {}; }
  money = Number(localStorage.getItem("money_v1") || "0");
  try{ cityBuildings = JSON.parse(localStorage.getItem("city_v1") || "[]"); }catch{ cityBuildings = []; }
  moneyEl.textContent = money;
  sync3DLayer();
}

/* å›³é‘‘ */
zukanBtnEl?.addEventListener("click", ()=>{ zukanPanelEl.classList.add("active"); zukanPanelEl.setAttribute("aria-hidden","false"); });
closeZukanEl?.addEventListener("click", ()=>{ zukanPanelEl.classList.remove("active"); zukanPanelEl.setAttribute("aria-hidden","true"); });

/* ç« ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ */
function buildChapterFilter(){
  if(!chapterFilterEl) return;
  chapterFilterEl.innerHTML = `<option value="ALL">ç« ï¼šãœã‚“ã¶</option>`;
  const chapters = dataSets[currentEra].chapters;
  Object.keys(chapters).forEach(ch=>{
    const opt = document.createElement("option");
    opt.value = ch; opt.textContent = ch;
    chapterFilterEl.appendChild(opt);
  });
}

  function pickOnGround(ev){
  setPointerFromEvent(ev);
  raycaster.setFromCamera(pointer, camera);

  const hit = raycaster.intersectObject(ground, false)[0];
  if (hit) return { cell: worldToGrid(hit.point.x, hit.point.z), hit };

  // äºˆå‚™: y=0 ã®å¹³é¢
  const plane = new THREE.Plane(new THREE.Vector3(0,1,0), 0);
  const p3 = new THREE.Vector3();
  if (raycaster.ray.intersectPlane(plane, p3)) {
    return { cell: worldToGrid(p3.x, p3.z), hit: null };
  }
  return null;
}

  function openQuiz(name){
  currentQuizName = name;
  quizTitleEl.textContent = name;
  quizHintEl.textContent  = "ï¼ˆä¾‹ï¼šã¦ã‚“ã½ã†ï¼ã‚ã—ã‚“ ãªã© ã²ã‚‰ãŒãªã§ï¼‰";
  quizHintEl.style.color = "#666"; // â˜…è¿½åŠ ï¼šè‰²ã‚’æ¯å›ãƒªã‚»ãƒƒãƒˆ
  quizInputEl.value = "";
  quizModalEl.style.display = "flex";
  setTimeout(()=>quizInputEl.focus(), 0);
}


/* ãƒ«ãƒ“è¡¨è¨˜ */
function withRubyMasked(fullName){
  const m = dataSets[currentEra].ruby[fullName];
  if(m){
    const sp = fullName.indexOf(" ");
    const year = fullName.slice(0, sp);
    return `<span class="yr">${year}</span> ${m}`;
  }
  return fullName;
}

/* ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ */
function buildCards(){
  if(!cardsWrap) return;
  cardsWrap.innerHTML = "";
  const sel = chapterFilterEl ? chapterFilterEl.value : "ALL";
  const chapters = dataSets[currentEra].chapters;

  Object.keys(chapters).forEach(ch=>{
    if(sel !== "ALL" && sel !== ch) return;
    Object.keys(chapters[ch]).forEach(name=>{
      const el = document.createElement("div");
      el.className = "card";
      el.dataset.card = name;
      el.setAttribute("role","button");
      el.setAttribute("tabindex","0");

      if(gotCards[name]){
        el.innerHTML = withRubyMasked(name);
        el.classList.add("done");
      }else{
        el.textContent = "ï¼Ÿ\n" + name.split(" ")[0];
      }
      el.addEventListener("click", ()=>onCardClick(el, name));
      el.addEventListener("keydown", (e)=>{ if(e.key==="Enter" || e.key===" "){ e.preventDefault(); onCardClick(el, name); }});
      cardsWrap.appendChild(el);
    });
  });
}

/* ã‚¯ã‚¤ã‚ºå‡¦ç† */
const quizModalEl = document.getElementById("quizModal");
const quizTitleEl = document.getElementById("quizTitle");
const quizHintEl  = document.getElementById("quizHint");
const quizInputEl = document.getElementById("quizInput");
const quizOkEl    = document.getElementById("quizOk");
const quizCancelEl= document.getElementById("quizCancel");
const quizBgEl    = document.getElementById("quizBg");
let currentQuizName = null;

function openQuiz(name){
  currentQuizName = name;
  quizTitleEl.textContent = name;
  quizHintEl.textContent  = "ï¼ˆä¾‹ï¼šã¦ã‚“ã½ã†ï¼ã‚ã—ã‚“ ãªã© ã²ã‚‰ãŒãªã§ï¼‰";
  quizInputEl.value = "";
  quizModalEl.style.display = "flex";
  setTimeout(()=>quizInputEl.focus(), 0);
}
function closeQuiz(){ quizModalEl.style.display = "none"; currentQuizName = null; }
function onCardClick(_el, name){ if(gotCards[name]) return; openQuiz(name); }

quizOkEl?.addEventListener("click", ()=>{
  if(!currentQuizName) return;
  const blanks = dataSets[currentEra].blanks[currentQuizName] || [];
  const ansRaw = quizInputEl.value || "";
  if(!onlyHiraAndSep(ansRaw)){ alert("ã²ã‚‰ãŒãªã§å…¥åŠ›ã—ã¦ã­ï¼ˆåŒºåˆ‡ã‚Šã¯ ã‚¹ãƒšãƒ¼ã‚¹ / ãƒ» / ã€ / ï¼ ã§ã‚‚OKï¼‰"); return; }
  const userTokens = normalizeTokens(splitTokens(ansRaw));
  const needTokens = normalizeTokens(blanks);
  const ok = needTokens.length>0 && needTokens.every(tok => userTokens.includes(tok));
  if(ok){
    gotCards[currentQuizName] = true;
    money += 10;
    moneyEl.textContent = money;
    persist();
    buildCards();
    closeQuiz();
    infoBoxEl.textContent = "æ­£è§£ï¼ğŸ’°ãŒãµãˆãŸã‚ˆã€‚ã‚·ãƒ§ãƒƒãƒ—ã§å¥½ããªå ´æ‰€ã«å»ºç‰©ã‚’ç½®ã„ã¦ã¿ã‚ˆã†ï¼";
 }else{
  const ans = needTokens.join("ãƒ»");
  // ç”»é¢ä¸‹ã®ã‚¤ãƒ³ãƒ•ã‚©ã«å‡ºã™
  infoBoxEl.textContent = "ã–ã‚“ã­ã‚“ï¼æ­£è§£ã¯ã€Œ" + ans + "ã€ã ã‚ˆã€‚";
  // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã«ã‚‚å‡ºã™ï¼ˆèµ¤å­—ï¼‰
  quizHintEl.textContent = "â†’ æ­£è§£ï¼š" + ans + "ï¼ˆã²ã‚‰ãŒãªï¼‰";
  quizHintEl.style.color = "#c62828";
  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã¯é–‹ã„ãŸã¾ã¾ï¼ˆã‚„ã‚Šç›´ã—å¯èƒ½ï¼‰
}
});
quizCancelEl?.addEventListener("click", closeQuiz);
quizBgEl?.addEventListener("click", closeQuiz);

/* ã‚·ãƒ§ãƒƒãƒ— */
const SHOP_ITEMS = [
  { id:"house",   name:"å®¶",        price:30,  cat:"building",      preview:"ğŸ " },
  { id:"shop",    name:"å•†å®¶",      price:40,  cat:"building",      preview:"ğŸª" },
  { id:"castle",  name:"åŸ",        price:120, cat:"building",      preview:"ğŸ¯" },
  { id:"temple",  name:"å¯º",      price:70,  cat:"building",      preview:"â›©ï¸" },
  { id:"tree",    name:"æœ¨",        price:8,   cat:"nature",        preview:"ğŸŒ³" },
  { id:"field",   name:"ç•‘",        price:12,  cat:"nature",        preview:"ğŸŒ¾" },
  { id:"road",    name:"é“è·¯",      price:10,  cat:"infrastructure",preview:"ğŸ›£ï¸" },
  { id:"bridge",  name:"æ©‹",        price:25,  cat:"infrastructure",preview:"ğŸŒ‰" },
  { id:"school",  name:"å­¦æ ¡",      price:80,  cat:"building",      preview:"ğŸ«" }
];

let shopFilter = "ALL";
function renderShop(){
  if(!shopGridEl) return;
  shopGridEl.innerHTML = "";
  SHOP_ITEMS
    .filter(it => shopFilter === "ALL" || it.cat === shopFilter)
    .forEach(it => {
      const card = document.createElement("div");
      card.className = "shop-card";
      card.innerHTML = `
        <h4>${it.name}</h4>
        <div class="preview">${it.preview}</div>
        <div class="buyrow">
          <span class="price">ğŸ’°${it.price} ä¸¡</span>
          <button data-buy="${it.id}">è²·ã†</button>
        </div>`;
      shopGridEl.appendChild(card);
    });

  shopGridEl.querySelectorAll("[data-buy]").forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.getAttribute("data-buy");
      const item = SHOP_ITEMS.find(s => s.id === id);
      if(!item) return;
      startPlacementFlow(item); // ä½ç½®é¸æŠãƒ¢ãƒ¼ãƒ‰ã¸
    });
  });
}
openShopBtnEl?.addEventListener("click", ()=>{ shopOverlayEl.classList.add("active"); renderShop(); });
shopCloseEl?.addEventListener("click", ()=> shopOverlayEl.classList.remove("active"));
shopOverlayEl?.addEventListener("click", (e)=>{ if(e.target===shopOverlayEl) shopOverlayEl.classList.remove("active"); });
document.querySelectorAll(".toolrow .toolbtn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    document.querySelectorAll(".toolrow .toolbtn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    shopFilter = btn.getAttribute("data-filter") || "ALL";
    renderShop();
  });
});

/* é…ç½®ãƒ•ãƒ­ãƒ¼ */
let pendingPurchase = null; // {type, price, rot}
function occupiedKey(x,y){ return `${x},${y}`; }
function occupiedSet(){ return new Set(cityBuildings.map(b=>occupiedKey(b.x,b.y))); }

function startPlacementFlow(item){
 if(money < item.price){
    alert("ãŠé‡‘ãŒè¶³ã‚Šãªã„ã‚ˆï¼ã‚¯ã‚¤ã‚ºã§ğŸ’°ã‚’å¢—ã‚„ã—ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦ãŸã‚ã—ã¦ã­ã€‚");
    return;
  }
  pendingPurchase = { type: item.id, price: item.price, rot: 0 };
  infoBoxEl.textContent = "ç½®ãå ´æ‰€ã‚’ãˆã‚‰ã‚“ã§ã­ï¼ˆã‚¿ãƒƒãƒ—/ã‚¯ãƒªãƒƒã‚¯ã§ç¢ºå®šã€å³ã‚¯ãƒªãƒƒã‚¯/Escã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€R/â†»ã§å›è»¢ï¼‰";
  shopOverlayEl.classList.remove("active");

  // 3Dãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸é–‹å§‹é€šçŸ¥ï¼ˆå æœ‰ãƒã‚¹ã¨ç›¤é¢ã‚µã‚¤ã‚ºã‚’æ¸¡ã™ï¼‰
  const occ = Array.from(occupiedSet()).map(s=>s.split(',').map(n=>Number(n)));
  document.dispatchEvent(new CustomEvent("placement:start", {
    detail: { type: item.id, cols: COLS, rows: ROWS, occupied: occ }
  }));
}

/* 3Dã‹ã‚‰ã®é…ç½®ç¢ºå®š/ã‚­ãƒ£ãƒ³ã‚»ãƒ«é€šçŸ¥ */
document.addEventListener("placement:confirm", (ev)=>{
  if(!pendingPurchase) return;
  const { x, y, rot=0, type } = ev.detail || {};
  if(x<0 || y<0 || x>=COLS || y>=ROWS){ infoBoxEl.textContent="ã¯ã¿å‡ºã—ã¦ã‚‹ã‚ˆï¼åˆ¥ã®å ´æ‰€ã«ç½®ã„ã¦ã­ã€‚"; return; }
  if(occupiedSet().has(occupiedKey(x,y))){ infoBoxEl.textContent="ãã®å ´æ‰€ã¯ä½¿ãˆãªã„ã‚ˆï¼"; return; }
  if(money < pendingPurchase.price){ alert("ãŠé‡‘ãŒè¶³ã‚Šãªã„ã‚ˆï¼"); document.dispatchEvent(new Event("placement:end")); pendingPurchase=null; return; }

  money -= pendingPurchase.price;
  moneyEl.textContent = money;
  placeBuildingAt(type, x, y, rot);
  infoBoxEl.textContent = "è¨­ç½®ã—ãŸã‚ˆï¼";
  pendingPurchase = null;
  persist();
  document.dispatchEvent(new Event("placement:end"));
  sparkle();
});
document.addEventListener("placement:cancel", ()=>{ pendingPurchase = null; infoBoxEl.textContent = "ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸã‚ˆã€‚"; });

/* å®Ÿé…ç½®ï¼ˆä¿å­˜â†’3Dã¸é€šçŸ¥ï¼‰ */
function placeBuildingAt(type, x, y, rot=0){
  const id = Date.now().toString(36) + Math.random().toString(36).slice(2,7);
  const placed = { id, type, x, y, rot };
  cityBuildings.push(placed);
  persist();
  document.dispatchEvent(new CustomEvent("city:add", { detail: placed }));
}

/* è¨­ç½®å¾Œã®å›è»¢ï¼šThreeå´ã‹ã‚‰ä¿å­˜æ›´æ–° */
document.addEventListener("edit:rotate", (ev)=>{
  const { id, rot } = ev.detail || {};
  const t = cityBuildings.find(b => b.id === id);
  if(!t) return;
  t.rot = rot % 360;
  persist();
});

/* å…¨ä½“ã‚’3Dã¸åŒæœŸï¼ˆèª­è¾¼ãƒ»ãƒªã‚»ãƒƒãƒˆæ™‚ï¼‰ */
function sync3DLayer(){
  document.dispatchEvent(new CustomEvent("city:reset"));
  cityBuildings.forEach(b=> document.dispatchEvent(new CustomEvent("city:add", { detail: b })));
}

/* ãã‚‰ãã‚‰æ¼”å‡º */
function sparkle(){
  for(let i=0;i<8;i++){
    const p=document.createElement("div");
    p.className="petal"; p.textContent="âœ¨";
    p.style.left = (20+Math.random()*60) + "vw";
    p.style.animationDuration = (2 + Math.random()*1.5) + "s";
    document.body.appendChild(p);
    setTimeout(()=>p.remove(), 4000);
  }
}

/* ãƒªã‚»ãƒƒãƒˆ */
resetBtnEl?.addEventListener("click", ()=>{
  if(!confirm("é€²æ—ã¨æ‰€æŒé‡‘ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) return;
  gotCards = {}; money = 0; cityBuildings = [];
  persist(); buildCards(); moneyEl.textContent = money;
  infoBoxEl.textContent = "ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã£ã¦å­¦ã¼ã†ï¼";
  sync3DLayer();
});

/* ã‚»ãƒ¬ã‚¯ãƒˆå¤‰æ›´ */
eraSelectEl?.addEventListener("change", ()=>{
  currentEra = eraSelectEl.value;
  loadProgress();
  buildChapterFilter();
  buildCards();
});
chapterFilterEl?.addEventListener("change", buildCards);

/* ãƒŠãƒ“ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ */
document.getElementById("playEdo")?.addEventListener("click", ()=>{ eraSelectEl.value="edo";      eraSelectEl.dispatchEvent(new Event("change")); });
document.getElementById("playSengoku")?.addEventListener("click", ()=>{ eraSelectEl.value="sengoku"; eraSelectEl.dispatchEvent(new Event("change")); });
document.getElementById("playMuromachi")?.addEventListener("click", ()=>{ eraSelectEl.value="muromachi";eraSelectEl.dispatchEvent(new Event("change")); });
document.getElementById("playKamakura")?.addEventListener("click", ()=>{ eraSelectEl.value="kamakura"; eraSelectEl.dispatchEvent(new Event("change")); });

/* ã‚¹ãƒãƒ›HUDé€£æº */
setHidden('xxx', true);
setHidden('yyy', false);
document.addEventListener("placement:cancel",()=>{ placeHud.hidden = true;  });
btnRotate?.addEventListener("click", ()=>{ document.dispatchEvent(new Event("placement:rotate")); });
btnCancel?.addEventListener("click", ()=>{ document.dispatchEvent(new Event("placement:cancel")); });

/* èµ·å‹• */
function init(){
  currentEra = eraSelectEl ? eraSelectEl.value : "edo";
  loadProgress();
  buildChapterFilter();
  buildCards();
  document.querySelector('.toolrow .toolbtn[data-filter="ALL"]')?.classList.add("active");
}
document.addEventListener("DOMContentLoaded", init);


  /* ========== ã‚¹ãƒ†ã‚£ãƒƒã‚¯æ“ä½œï¼ˆã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ï¼‰ ========== */
const joypadEl  = document.getElementById("joypad");
const joyStick  = joypadEl?.querySelector(".joy-stick");

let joyActive = false, joyRAF = null, joyDir = {dx:0, dy:0}, joyLastStepAt = 0;

function joyShow(){ if(joypadEl) joypadEl.hidden = false; }
function joyHide(){ if(joypadEl) joypadEl.hidden = true; }

function quantizeDir(vx, vy){
  // vx: å³+, vy: ä¸Š+ï¼ˆå¾Œã§yåè»¢ã™ã‚‹ï¼‰
  const mag = Math.hypot(vx, vy);
  if (mag < 0.15) return {dx:0, dy:0, speed:0}; // ãƒ‡ãƒƒãƒ‰ã‚¾ãƒ¼ãƒ³

  // è§’åº¦ã‚’8æ–¹å‘ã«é‡å­åŒ–
  const ang = Math.atan2(vy, vx); // -PI..PI
  const sector = Math.round(ang / (Math.PI/4)); // -4..4
  const dir8 = (sector + 8) % 8;

  // 8æ–¹å‘ â†’ (dx,dy)
  const table = [
    {dx:1, dy:0},   // 0: â†’
    {dx:1, dy:1},   // 1: â†—
    {dx:0, dy:1},   // 2: â†‘
    {dx:-1,dy:1},   // 3: â†–
    {dx:-1,dy:0},   // 4: â†
    {dx:-1,dy:-1},  // 5: â†™
    {dx:0, dy:-1},  // 6: â†“
    {dx:1, dy:-1}   // 7: â†˜
  ];
  const {dx, dy} = table[dir8];

  // é€Ÿåº¦ï¼ˆå¤–å‘¨ã»ã©é€Ÿã„ï¼‰
  let speed;
  if (mag > 0.85) speed = 60;     // ms/step
  else if (mag > 0.55) speed = 90;
  else speed = 130;

  // ç”»é¢ä¸Šã§ã¯ä¸ŠãŒãƒã‚¤ãƒŠã‚¹ã«é€²ã‚€ã®ã§ã€yã¯ãã®ã¾ã¾ï¼ˆTHREEå´ã§æ¸›å°‘ãŒä¸Šï¼‰
  // ã“ã“ã§ã¯ {dx,dy} ã‚’ãã®ã¾ã¾æ¸¡ã™ï¼ˆdy:-1ãŒä¸‹ã€+1ãŒä¸Šã«ãªã‚‹ã‚ˆã† THREEå´ã§æ‰±ã†ï¼‰
  return {dx, dy, speed};
}

function joyStepLoop(ts){
  if(!joyActive){ joyRAF = null; return; }
  if(!joyDir.speed){ joyRAF = requestAnimationFrame(joyStepLoop); return; }

  if(ts - joyLastStepAt >= joyDir.speed){
    document.dispatchEvent(new CustomEvent("placement:nudge", { detail: { dx: joyDir.dx, dy: -joyDir.dy }}));
    // â†‘ dy ã‚’åè»¢ï¼šç”»é¢ã®ä¸Šæ–¹å‘ãƒ‰ãƒ©ãƒƒã‚°ã§ã€Œæ‰‹å‰â†’ä¸Šï¼ˆy-1ï¼‰ã€ã¸
    joyLastStepAt = ts;
  }
  joyRAF = requestAnimationFrame(joyStepLoop);
}

function joyStart(x, y){
  joyActive = true; joyLastStepAt = 0;
  // ã‚¹ãƒ†ã‚£ãƒƒã‚¯ä½ç½®ã‚’å‹•ã‹ã™
  joyMove(x, y);
  if(!joyRAF) joyRAF = requestAnimationFrame(joyStepLoop);
}
function joyMove(x, y){
  const rect = joypadEl.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top  + rect.height/2;
  let dx = (x - cx) / (rect.width/2);   // -1..1
  let dy = (y - cy) / (rect.height/2);  // -1..1
  const mag = Math.hypot(dx, dy);
  if(mag > 1){ dx/=mag; dy/=mag; }

  // ãƒãƒ–è¦‹ãŸç›®
  if(joyStick){
    const px = dx * 28, py = dy * 28; // åŠå¾„ ~28px
    joyStick.style.transform = `translate(${px}px, ${py}px)`;
  }

  joyDir = quantizeDir(dx, -dy); // ç”»é¢åº§æ¨™â†’ä¸ŠãŒæ­£ã«è¦‹ãˆã‚‹ã‚ˆã†åè»¢ã—ã¦é‡å­åŒ–
}
function joyEnd(){
  joyActive = false; joyDir = {dx:0, dy:0, speed:0};
  if(joyRAF){ cancelAnimationFrame(joyRAF); joyRAF = null; }
  if(joyStick){ joyStick.style.transform = "translate(0,0)"; }
}

// å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆ
if(joypadEl){
  const onDown = (e)=>{ const p = e.touches ? e.touches[0] : e; joyStart(p.clientX, p.clientY); };
  const onMove = (e)=>{ if(!joyActive) return; const p = e.touches ? e.touches[0] : e; joyMove(p.clientX, p.clientY); };
  const onUp   = ()=> joyEnd();

  joypadEl.addEventListener("pointerdown", onDown);
  joypadEl.addEventListener("pointermove", onMove);
  window.addEventListener("pointerup", onUp);
  joypadEl.addEventListener("touchstart", onDown, {passive:false});
  joypadEl.addEventListener("touchmove",  onMove, {passive:false});
  window.addEventListener("touchend", onUp);
}

// é…ç½®ãƒ•ãƒ­ãƒ¼ã¨é€£å‹•ï¼ˆè¡¨ç¤º/éè¡¨ç¤ºï¼‰
document.addEventListener("placement:start", ()=>{ joyShow(); });
document.addEventListener("placement:end",   ()=>{ joyHide(); joyEnd(); });
document.addEventListener("placement:cancel",()=>{ joyHide(); joyEnd(); });

// ã€Œæ±ºå®šã€ãƒœã‚¿ãƒ³ â†’ THREE å´ã«OKã‚·ã‚°ãƒŠãƒ«
document.getElementById("btnOK")?.addEventListener("click", ()=>{
  document.dispatchEvent(new Event("placement:ok"));
});


  </script>

  <script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
  }
}
</script>

  

<!-- ===== Three.js ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ ===== -->
<script type="module">

 // --- å®‰å…¨ã« hidden ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆè¦ç´ ãŒç„¡ãã¦ã‚‚è½ã¡ãªã„ï¼‰---
function setHidden(idOrEl, value){
  const el = typeof idOrEl === 'string' ? document.getElementById(idOrEl) : idOrEl;
  if (!el) { console.warn('[UI missing]', idOrEl); return false; }
  el.hidden = !!value;
  return true;
}
// classã®è¡¨ç¤º/éè¡¨ç¤ºã‚’ä½¿ã†ç‰ˆï¼ˆãŠå¥½ã¿ã§ï¼‰
function setShown(idOrEl, shown){
  const el = typeof idOrEl === 'string' ? document.getElementById(idOrEl) : idOrEl;
  if (!el) { console.warn('[UI missing]', idOrEl); return false; }
  if (shown) el.removeAttribute('hidden'); else el.setAttribute('hidden','');
  return true;
}

/* ========= ä¾å­˜ ========= */
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
import { TransformControls } from 'three/addons/controls/TransformControls.js';

/* ========= ç”»é¢UIï¼ˆãƒ„ãƒ¼ãƒ«ãƒãƒ¼ï¼‰ã‚’JSã‹ã‚‰æ³¨å…¥ ========= */
(() => {
  const css = `
  #ui-toolbar{
    position: fixed; z-index: 9999; top: 16px; right: 16px;
    display: flex; gap: 8px; align-items: center;
    background: rgba(255,255,255,.92);
    border: 1px solid #e5e7eb; border-radius: 12px; padding: 8px 10px;
    box-shadow: 0 6px 20px rgba(0,0,0,.12);
    font-family: system-ui, -apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;
  }
  #ui-toolbar button{
    appearance: none; border: 1px solid #e5e7eb; border-radius: 10px;
    background: #fff; padding: 6px 10px; cursor: pointer; font-size: 14px;
  }
  #ui-toolbar button.active{ background: #fcd34d; border-color: #f59e0b; }
  #ui-toolbar #ui-hint{ margin-left: 4px; font-size: 13px; color: #374151; }
  canvas { outline: none; }
  `;
  const style = document.createElement('style'); style.textContent = css; document.head.appendChild(style);

  const bar = document.createElement('div'); bar.id = 'ui-toolbar';
  bar.innerHTML = `
    <button id="btn-select" class="active" title="å»ºç‰©ã‚’é¸æŠ">é¸æŠ</button>
    <button id="btn-move"   title="é¸æŠã—ãŸå»ºç‰©ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•">ç§»å‹•</button>
    <button id="btn-delete" title="ã‚¯ãƒªãƒƒã‚¯ã—ãŸå»ºç‰©ã‚’å‰Šé™¤">å‰Šé™¤</button>
    <span id="ui-hint">ãƒ¢ãƒ¼ãƒ‰: é¸æŠ</span>
  `;
  document.body.appendChild(bar);
})();

/* ========= Three.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ========= */
const townEl = document.getElementById("town");
let renderer, scene, camera, controls, loader, ground, grid;
let placed3D = [];                  // è¨­ç½®æ¸ˆã¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®â€œãƒ«ãƒ¼ãƒˆâ€é…åˆ—
let tControls = null;               // TransformControls ã¯ ensureRenderer å†…ã§ç”Ÿæˆ

let COLS = 30, ROWS = 18;
const WORLD_SCALE = 1.0;
const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

function gridToWorld(x, y){
  const ox = Math.floor(COLS/2), oy = Math.floor(ROWS/2);
  return new THREE.Vector3((x-ox)*WORLD_SCALE, 0, (y-oy)*WORLD_SCALE);
}
function worldToGrid(X,Z){
  const ox = Math.floor(COLS/2), oy = Math.floor(ROWS/2);
  return { x: Math.round(X/WORLD_SCALE)+ox, y: Math.round(Z/WORLD_SCALE)+oy };
}

/* === åœ°é¢ã«è¼‰ã›ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ === */
const EPS_Y = 0.01;
function snapBaseY(obj, targetY = 0){
  obj.updateWorldMatrix(true, true);
  const box = new THREE.Box3().setFromObject(obj);
  const dy  = (targetY + EPS_Y) - box.min.y;
  obj.position.y += dy;
  obj.updateWorldMatrix(true, true);
}

function ensureRenderer(){
  if(renderer) return;
  const w = townEl.clientWidth, h = townEl.clientHeight;

  renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
  renderer.setSize(w, h);
  renderer.domElement.style.position = "absolute";
  renderer.domElement.style.inset = "0";
  townEl.style.position = "relative";
  townEl.appendChild(renderer.domElement);

  scene = new THREE.Scene();

  camera = new THREE.PerspectiveCamera(50, w/h, 0.1, 1000);

  controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.06;
  controls.maxPolarAngle = Math.PI / 2 - 0.01;
  controls.minPolarAngle = 0.1;
  controls.screenSpacePanning = false;
  controls.addEventListener('change', () => {
    const minTargetY = 0.1;
    if (controls.target.y < minTargetY) {
      const dy = minTargetY - controls.target.y;
      controls.target.y += dy;
      camera.position.y = Math.max(camera.position.y + dy, minTargetY + 0.01);
    }
  });

  const center = gridToWorld(Math.floor(COLS/2), Math.floor(ROWS/2));
  controls.target.copy(center);
  camera.position.set(center.x + 15, 18, center.z + 22);

  scene.add(new THREE.AmbientLight(0xffffff, 1.0));
  const dir = new THREE.DirectionalLight(0xffffff, 1.2);
  dir.position.set(10, 20, 10);
  scene.add(dir);

  const plane = new THREE.PlaneGeometry(100, 100);
  const pm = new THREE.MeshBasicMaterial({ color: 0xd7f4d2, side: THREE.FrontSide });
  ground = new THREE.Mesh(plane, pm);
  ground.rotation.x = -Math.PI/2;
  ground.name = "ground";
  scene.add(ground);

  grid = new THREE.GridHelper(100, 100, 0x000000, 0x000000);
  grid.material.opacity = 0.08;
  grid.material.transparent = true;
  scene.add(grid);

  loader = new GLTFLoader();

  renderer.setAnimationLoop(()=>{ controls.update(); renderer.render(scene, camera); });

  controls.minPolarAngle = 0.1;
  controls.maxPolarAngle = Math.PI / 2.02;

  new ResizeObserver(()=>{
    const w2 = townEl.clientWidth, h2 = townEl.clientHeight;
    renderer.setSize(w2, h2);
    camera.aspect = w2/h2;
    camera.updateProjectionMatrix();
  }).observe(townEl);

  /* === ç§»å‹•ãƒãƒ³ãƒ‰ãƒ«ï¼ˆTransformControlsï¼‰ === */
  tControls = new TransformControls(camera, renderer.domElement);
  tControls.setMode('translate');
  tControls.addEventListener('dragging-changed', e => { controls.enabled = !e.value; });
  scene.add(tControls);
}
ensureRenderer();

/* ========= ãƒ¢ãƒ‡ãƒ«URL ========= */
const MODEL_URLS = {
  house:  "/assets/_m/house.2a9f3.glb",
  shop:   "/assets/_m/j8ap2an8eses0ho1p.glb",
  castle: "/assets/_m/ja76386p2an8esecas6t9le.glb",
  temple: "/assets/_m/japanese.tem3pl4e1383.glb",
  tree:   "/assets/_m/t6r7e9e.glb",
  field:  "/assets/_m/f2i342el2d.glb",
  road:   "/assets/_m/w8a9l0k9w7a2y.glb",
  bridge: "/assets/_m/b7r89i6d8g9e.glb",
  school: "/assets/_m/s7c7h9o89ol.glb",
};

/* ========= ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ ========= */
function fallbackMesh(type, big=false){
  const s = big ? 1.6 : 0.9;
  const g = new THREE.BoxGeometry(s, s, s);
  const m = new THREE.MeshStandardMaterial({ color: 0x2ecc71, emissive: 0x0, metalness:0.1, roughness:0.8 });
  const mesh = new THREE.Mesh(g, m);
  mesh.position.y = s/2;
  return mesh;
}

/* ========= è¨­ç½® ========= */
async function place3D({id, type, x, y, rot=0}){
  const pos = gridToWorld(x, y);
  let obj; const url = MODEL_URLS[type];
  if(url){
    try { const gltf = await loader.loadAsync(url); obj = gltf.scene; obj.scale.set(0.8,0.8,0.8); }
    catch { obj = fallbackMesh(type); }
  }else{
    obj = fallbackMesh(type);
  }
  obj.position.copy(pos);
  obj.rotation.y = (rot/90) * Math.PI/2;

  snapBaseY(obj, 0);

  obj.userData.id  = id  || null;
  obj.userData.rot = rot || 0;
  scene.add(obj);
  placed3D.push(obj);
}
function clear3D(){ placed3D.forEach(o=>scene.remove(o)); placed3D = []; }

/* ========= å…±é€šãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼ ========= */
const raycaster = new THREE.Raycaster();
const pointer   = new THREE.Vector2();

/* ========= é…ç½®ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä»˜ãï¼‰ ========= */
let placing=false, preview=null, placeType=null, placeRot=0;
let occSet = new Set();
let hoverCell = {x:-1,y:-1};
const okMat=new THREE.MeshBasicMaterial({ color:0x2e7d32, transparent:true, opacity:0.5 });
const ngMat=new THREE.MeshBasicMaterial({ color:0xc62828, transparent:true, opacity:0.5 });

function setPointerFromEvent(ev){
  const rect = renderer.domElement.getBoundingClientRect();
  const cx = ((ev.clientX ?? (ev.touches?.[0]?.clientX || 0)) - rect.left) / rect.width;
  const cy = ((ev.clientY ?? (ev.touches?.[0]?.clientY || 0)) - rect.top) / rect.height;
  pointer.x = cx * 2 - 1; pointer.y = -(cy * 2 - 1);
}
function pickOnGround(ev){
  setPointerFromEvent(ev);
  raycaster.setFromCamera(pointer, camera);
  const hit = raycaster.intersectObject(ground, false)[0];
  if(!hit) return null;
  return { cell: worldToGrid(hit.point.x, hit.point.z) };
}
function cellValid(x,y){ return (x>=0 && y>=0 && x<COLS && y<ROWS) && !occSet.has(`${x},${y}`); }

function applyTint(obj,mat){
  obj.traverse?.(n=>{
    if(n.isMesh){
      if(!n.userData._origMat) n.userData._origMat = n.material;
      n.material = mat;
    }
  });
}
function restoreTint(obj){
  obj.traverse?.(n=>{
    if(n.isMesh && n.userData._origMat){ n.material = n.userData._origMat; delete n.userData._origMat; }
  });
}
async function ensurePreview(){
  if (preview) return preview;
  preview = fallbackMesh(placeType, true);
  scene.add(preview);
  snapBaseY(preview, 0);
  const url = MODEL_URLS[placeType];
  if (url) {
    try{
      const gltf = await loader.loadAsync(url);
      const real = gltf.scene;
      real.scale.set(0.8,0.8,0.8);
      real.position.copy(preview.position);
      real.rotation.copy(preview.rotation);
      scene.add(real);
      scene.remove(preview);
      preview = real;
      snapBaseY(preview, 0);
    }catch(e){}
  }
  return preview;
}
function setPreviewAtCell(cell){
  hoverCell = cell;
  const pos = gridToWorld(cell.x, cell.y);
  preview.position.copy(pos);
  preview.rotation.y = (placeRot/90) * Math.PI/2;
  const valid = cellValid(cell.x, cell.y);
  restoreTint(preview);
  applyTint(preview, valid ? okMat : ngMat);
}
function endPlacement(){
  placing=false; placeType=null; placeRot=0; occSet.clear();
  if(preview){ scene.remove(preview); preview=null; }
  renderer.domElement.style.cursor="default";
  controls.enabled = true;
}

/* ========= é…ç½®ã‚¤ãƒ™ãƒ³ãƒˆ ========= */
document.addEventListener("placement:start", async (ev)=>{
  const { type, cols, rows, occupied=[] } = ev.detail || {};
  COLS = cols ?? COLS; ROWS = rows ?? ROWS;

  placing = true; placeType = type; placeRot = 0;
  occSet = new Set(occupied.map(([x,y]) => `${x},${y}`));

  controls.enabled = false;
  renderer.domElement.style.cursor = "crosshair";

  await ensurePreview();

  // ä¸­å¤®ã‹ã‚‰è¿‘å‚ã®ç©ºããƒã‚¹ã‚’æ¢ã™
  const center = { x: Math.floor(COLS/2), y: Math.floor(ROWS/2) };
  const isFree = (c)=> c.x>=0 && c.y>=0 && c.x<COLS && c.y<ROWS && !occSet.has(`${c.x},${c.y}`);
  let init = center;
  if (!isFree(init)) {
    outer: for (let r=1; r<Math.max(COLS,ROWS); r++){
      for (let dx=-r; dx<=r; dx++){
        for (let dy=-r; dy<=r; dy++){
          const c = { x: center.x+dx, y: center.y+dy };
          if (isFree(c)){ init=c; break outer; }
        }
      }
    }
  }
  setPreviewAtCell(init);

  // ã‚«ãƒ¡ãƒ©å¯„ã›
  const t = gridToWorld(init.x, init.y);
  controls.target.copy(t);
  camera.position.set(t.x + 15, 18, t.z + 22);
  controls.update();
});
document.addEventListener("placement:end",   ()=> endPlacement());
document.addEventListener("placement:cancel",()=> endPlacement());
document.addEventListener("placement:rotate",()=>{ if(!placing) return; placeRot=(placeRot+90)%360; if(preview && hoverCell){ setPreviewAtCell(hoverCell); } });

// ãƒã‚¦ã‚¹ç§»å‹•ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¿½å¾“
renderer.domElement.addEventListener("pointermove", (ev)=>{
  if(!placing) return;
  const r = pickOnGround(ev); if(!r) return;
  setPreviewAtCell(r.cell);
}, { passive:true });

// ã‚¯ãƒªãƒƒã‚¯ã§ç¢ºå®š
function tryPlace(ev){
  if(!placing) return;
  const r = pickOnGround(ev); if(!r) return;
  const {x,y}=r.cell;
  if(!cellValid(x,y)) return;
  document.dispatchEvent(new CustomEvent("placement:confirm",{ detail:{ type:placeType, x, y, rot:placeRot }}));
  endPlacement();
}
renderer.domElement.addEventListener("click", tryPlace, { passive:false });

// å³ã‚¯ãƒªãƒƒã‚¯ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«
renderer.domElement.addEventListener("pointerdown", (ev)=>{
  if(placing && ev.button===2){ ev.preventDefault(); document.dispatchEvent(new Event("placement:cancel")); endPlacement(); }
});
renderer.domElement.addEventListener("contextmenu", (e)=>{ if(placing){ e.preventDefault(); } });

 // ã‚¹ãƒ†ã‚£ãƒƒã‚¯æ“ä½œï¼š1ã‚¹ãƒ†ãƒƒãƒ—ç§»å‹•
document.addEventListener("placement:nudge", (ev)=>{
  if(!placing || !hoverCell) return;
  const {dx=0, dy=0} = ev.detail || {};
  const nx = clamp(hoverCell.x + dx, 0, COLS-1);
  const ny = clamp(hoverCell.y + dy, 0, ROWS-1);
  setPreviewAtCell({x:nx, y:ny});
});

/* ========= ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼ˆé¸æŠï¼ç§»å‹•ï¼å‰Šé™¤ï¼‰ ========= */
let editMode = 'select';     // 'select' | 'move' | 'delete'
let selected = null;

function markSelected(obj){
  clearSelected();
  selected = obj;
  selected.traverse?.(n=>{
    if(n.isMesh && n.material && 'emissive' in n.material){
      n.userData.__origEmissive = n.material.emissive.clone();
      n.material.emissive.setHex(0xFF8800);
    }
  });
}
function clearSelected(){
  if(!selected) return;
  selected.traverse?.(n=>{
    if(n.isMesh && n.material && n.userData.__origEmissive){
      n.material.emissive.copy(n.userData.__origEmissive);
      delete n.userData.__origEmissive;
    }
  });
  selected = null;
}

const $btnSelect = document.getElementById('btn-select');
const $btnMove   = document.getElementById('btn-move');
const $btnDelete = document.getElementById('btn-delete');
const $hint      = document.getElementById('ui-hint');

function setEditMode(m){
  editMode = m;
  [$btnSelect,$btnMove,$btnDelete].forEach(b=>b.classList.remove('active'));
  if(m==='select') $btnSelect.classList.add('active');
  if(m==='move')   $btnMove.classList.add('active');
  if(m==='delete') $btnDelete.classList.add('active');
  $hint.textContent = `ãƒ¢ãƒ¼ãƒ‰: ${m==='select'?'é¸æŠ': m==='move'?'ç§»å‹•':'å‰Šé™¤'}`;
  if (tControls && m!=='move') tControls.detach();
  renderer.domElement.style.cursor = (m==='delete') ? 'not-allowed' : 'default';
}
$btnSelect.onclick = ()=> setEditMode('select');
$btnMove.onclick   = ()=> { setEditMode('move');  if(selected && tControls) tControls.attach(selected); };
$btnDelete.onclick = ()=> setEditMode('delete');
setEditMode('select');

/* === é…ç½®ãƒ¢ãƒ¼ãƒ‰ã§ãªã„æ™‚ã®ç·¨é›†ã‚¯ãƒªãƒƒã‚¯ === */
renderer.domElement.addEventListener('pointerup', (ev)=>{
  if(placing) return; // é…ç½®ä¸­ã¯ç·¨é›†ã—ãªã„

  const rect = renderer.domElement.getBoundingClientRect();
  const cx = (ev.clientX - rect.left) / rect.width;
  const cy = (ev.clientY - rect.top)  / rect.height;
  const p = new THREE.Vector2(cx*2-1, -(cy*2-1));
  raycaster.setFromCamera(p, camera);
  const hits = raycaster.intersectObjects(placed3D, true);

  if(!hits.length){
    clearSelected(); if (tControls) tControls.detach(); return;
  }
  let hit = hits[0].object;
  while(hit && !placed3D.includes(hit)) hit = hit.parent;
  if(!hit) return;

  if(editMode==='delete'){
    scene.remove(hit);
    placed3D = placed3D.filter(o=>o!==hit);
    if(hit.userData?.id) document.dispatchEvent(new CustomEvent('edit:delete', { detail:{ id: hit.userData.id }}));
    if(selected===hit){ clearSelected(); if (tControls) tControls.detach(); }
    return;
  }

  markSelected(hit);
  if(editMode==='move' && tControls) tControls.attach(hit);
});

/* ========= å…¬é–‹API ========= */
window.city3D = {
  place3D, clear3D,
  setEditMode,
  getSelected: ()=>selected
};
</script>



</body>
</html>











































