<!DOCTYPE html>
<html lang="ja">
  <script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"FAQPage",
  "mainEntity":[
    {
      "@type":"Question",
      "name":"対象は小学生ですか？",
      "acceptedAnswer":{"@type":"Answer","text":"はい。ですが、年少、年中、年長さんでも遊びながら歴史に親しめるように、ひらがなクイズや図鑑（年表）でやさしく学べます。"}
    },
    {
      "@type":"Question",
      "name":"無料で使えますか？",
      "acceptedAnswer":{"@type":"Answer","text":"無料で利用できます。サイト下部に広告が表示されます。"}
    },
    {
      "@type":"Question",
      "name":"どんな学習内容がありますか？",
      "acceptedAnswer":{"@type":"Answer","text":"江戸時代・室町時代の主要な出来事を、年と出来事を結びつけるクイズ、年表の拡張表示、カード収集と街づくり演出で学べます。"}
    },
    {
      "@type":"Question",
      "name":"スマホやタブレットでも使えますか？",
      "acceptedAnswer":{"@type":"Answer","text":"はい。縦画面・1画面で遊べるよう最適化しています。"}
    }
  ]
}
</script>

<head>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6Z9WN4HFK5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-6Z9WN4HFK5');
  </script>

  <!-- Search Console 所有権 -->
  <meta name="google-site-verification" content="bgJFyYeBgPsces8Rz5ONG_d-nj8ZEH_fHddcwAXMX0U" />

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <!-- SEO -->
<title>歴史キッズ｜小学生向け歴史学習サイト（江戸時代・室町時代のクイズ／年表／カードゲーム）</title>
<meta name="description" content="歴史キッズは小学生向けの歴史学習サイト。江戸時代・室町時代をクイズ／年表／カード集めの街づくりで楽しく学べます。スマホ対応・無料で遊べる子ども向け歴史教材。">
<link rel="canonical" href="https://historykids.github.io/">


  <!-- OGP -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://historykids.github.io/" />
  <meta property="og:title" content="楽しく学べる！子供向け歴史学習サイト｜歴史キッズ" />
  <meta property="og:description" content="江戸や室町の出来事をカードを集めながら学べる、子供向けの歴史学習サイト。遊びながら歴史を学ぼう！" />
  <meta property="og:image" content="https://historykids.github.io/thumbnail.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="楽しく学べる！子供向け歴史学習サイト｜歴史キッズ" />
  <meta name="twitter:description" content="江戸や室町の出来事をカードを集めながら学べる、子供向けの歴史学習サイト。" />
  <meta name="twitter:image" content="https://historykids.github.io/thumbnail.png" />

  <!-- AdSense（1つだけでOK） -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4922140858632050" crossorigin="anonymous"></script>

  <style>
    /* === 上部PRバー === */
.promoBar{
  background:#fffbe6;
  border-bottom:1px solid #e6d400;
  padding:8px 12px;
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:center;
  flex-wrap:wrap;
  box-shadow:0 1px 3px rgba(0,0,0,.08);
}
.promoBar b{ color:#b58900; }
.promoBar .title{ font-weight:700; }
.promoBar .button{
  display:inline-block; background:#ffd814; color:#111;
  padding:8px 12px; border-radius:8px; font-weight:700;
  text-decoration:none; box-shadow:0 1px 3px rgba(0,0,0,.15);
}
.promoBar small{ color:#666; }

    /* ← ここに今の CSS をそのまま置く（内容はあなたのままでOK） */
      :root{
    --edo-yellow:#FCD34D; --edo-info:#FFF8DC; --edo-border:#999;
    --bg:#FFF6E3; --shadow:rgba(0,0,0,.12); --ink:#222; --adbg:#f1f1f1;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,
      "Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif;}
  .wrap{display:flex;flex-direction:column;min-height:100svh;}
  header{position:sticky;top:0;z-index:3;background:var(--edo-yellow);
    padding:10px 12px;display:flex;gap:8px;align-items:center;justify-content:space-between;
    box-shadow:0 1px 4px var(--shadow);}
  header h1{font-size:18px;margin:0;font-weight:700}
  header .controls{display:flex;gap:8px;align-items:center}
  header button, header select{border:0;border-radius:10px;background:#fff;padding:6px 12px;
    font-weight:700;box-shadow:0 1px 3px var(--shadow);cursor:pointer}
  #resetBtn{background:#ffeaea}
  #info{padding:10px;background:var(--edo-info);border-bottom:1px solid #ccc;
    font-size:15px;min-height:40px}
  #town{position:relative;width:100%;height:44vh;min-height:260px;background:#fff;
    border-top:2px solid var(--edo-border);border-bottom:2px solid var(--edo-border);
    overflow:hidden}
  #cards{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;padding:10px}
  .card{width:28vw;max-width:110px;min-width:86px;height:120px;border-radius:12px;background:#ddd;
    display:flex;align-items:center;justify-content:center;font-weight:700;font-size:15px;
    cursor:pointer;box-shadow:0 2px 6px var(--shadow);user-select:none;text-align:center;padding:6px}
  .card.done{background:#cdeccd; color:#1a5e1a}
  .building{position:absolute;font-size:34px;opacity:0;transform:scale(.8);
    transition:opacity .7s, transform .7s}
  .show{opacity:1;transform:scale(1.2)}
  .villager{position:absolute;font-size:20px;animation:walk 8s linear infinite}
  @keyframes walk{0%{left:2%}50%{left:90%}100%{left:2%}}
  #zukanPanel{position:fixed;inset:0 0 auto 0;height:72%;top:-100%;background:#fff;
    border-bottom:3px solid #333;box-shadow:0 4px 16px var(--shadow);
    transition:top .45s ease;z-index:5;overflow:auto}
  #zukanPanel.active{top:0}
  #zukanHead{position:sticky;top:0;background:#fff;padding:10px;border-bottom:1px solid #eee;
    display:flex;align-items:center;gap:8px}
  #zukanHead h2{margin:0;font-size:18px}
  #closeZukan{margin-left:auto;border:0;background:#eee;border-radius:8px;padding:6px 12px;cursor:pointer}
  .zukanSec{padding:10px}
  .zukanSec h3{margin:8px 0}
  .zCard{display:inline-flex;align-items:center;justify-content:center;width:96px;height:116px;margin:4px;
    border:1px solid #ccc;border-radius:8px;box-shadow:0 1px 3px var(--shadow);white-space:pre-line;text-align:center;padding:6px}
  .locked{background:#eee;color:#999}
  #completeMsg{font-size:18px;font-weight:800;color:green;text-align:center;padding:10px}
  .petal{position:fixed;top:-10px;font-size:20px;animation:fall linear forwards;pointer-events:none}
  @keyframes fall{to{transform:translateY(110vh) rotate(360deg);opacity:0}}
  .adbar{position:sticky;bottom:0;background:var(--adbg);border-top:1px solid #ddd;
    padding:4px 8px; display:flex; justify-content:center; align-items:center; min-height:52px}
  .adslot{width:100%; max-width:728px; height:50px; background:
    repeating-linear-gradient(45deg,#eee,#eee 8px,#e2e2e2 8px,#e2e2e2 16px);
    border:1px dashed #bbb;border-radius:8px; display:flex; align-items:center; justify-content:center;
    font-size:12px; color:#666}
  footer{height:8px}
  .landscapeWarn{position:fixed;inset:0;background:rgba(0,0,0,.65);color:#fff;display:none;
    align-items:center;justify-content:center;z-index:20;text-align:center;padding:20px}
  @media (orientation:landscape){ .landscapeWarn{display:flex} }
  ruby rt{font-size:.7em;color:#444}
  .yr{font-weight:800;margin-right:2px}

  /* === クイズ用モーダル === */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:30}
  .modal.active{display:flex}
  .modal-bg{position:absolute;inset:0;background:rgba(0,0,0,.5)}
  .modal-box{position:relative;z-index:1;width:min(92vw,560px);background:#fff;border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,.2);padding:14px}
  .quiz-title{font-weight:800;font-size:16px;margin:0 0 6px 0}
  .quiz-instruction{font-size:14px;margin:6px 0 10px 0;color:#444}
  #quizInput{width:100%;padding:10px 12px;font-size:16px;border:1px solid #ccc;border-radius:10px}
  .quiz-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
  .quiz-actions button{border:0;border-radius:10px;padding:8px 14px;background:#eee;cursor:pointer}
  .quiz-actions #quizOk{background:#cdeccd;color:#145f14;font-weight:700}
  </style>
</head>




 

  
</script> 
<body>
<div class="wrap" role="application" aria-label="江戸・室町カードで町づくり（完成版）">
  <header>
    <h1>歴史キッズ｜小学生向け 歴史学習（江戸時代・室町時代）カードで町づくり！</h1>

    <div class="controls">
      <label for="eraSelect" style="font-size:12px">時代：</label>
      <select id="eraSelect" title="時代をえらぶ">
        <option value="edo">江戸時代</option>
        <option value="muromachi">室町時代</option>
      </select>
      <select id="chapterFilter" title="章をえらぶ">
        <option value="ALL">章：ぜんぶ</option>
      </select>
      <button id="zukanBtn" aria-controls="zukanPanel" aria-expanded="false">図鑑</button>
      <button id="resetBtn" title="進捗を全部消して最初から">リセット</button>
    </div>
  </header>
  <section id="intro" style="padding:10px 12px;background:#fff;">
  <p style="margin:0 0 8px;">
    小学生向けの<span style="font-weight:700;">歴史学習サイト</span>です。<br>
    <b>江戸時代・室町時代</b>の出来事を、<b>クイズ</b>と<b>年表</b>、<b>カード集め</b>で楽しく学べます（スマホ対応・無料）。
  </p>
  <nav style="display:flex;gap:8px;flex-wrap:wrap;">
    <a href="#cards" style="display:inline-block;background:#fcd34d;padding:8px 12px;border-radius:8px;font-weight:700;text-decoration:none;color:#222;">江戸時代で遊ぶ</a>
    <a href="#cards" style="display:inline-block;background:#fde68a;padding:8px 12px;border-radius:8px;font-weight:700;text-decoration:none;color:#222;">室町時代で遊ぶ</a>
    <a href="#zukanPanel" style="display:inline-block;background:#e5e7eb;padding:8px 12px;border-radius:8px;font-weight:700;text-decoration:none;color:#111;">図鑑（年表）を見る</a>
  </nav>
</section>

  <!-- PR：おすすめの本（ドラえもん） -->
<div class="promoBar" role="note" aria-label="おすすめの本（PR）">
  <b>PR</b>
  <span class="title">歴史入門にぴったり！<strong>ドラえもんの社会科おもしろ攻略 日本の歴史</strong>（小学館）</span>
  <a id="promoLink" class="button"
     href="https://amzn.asia/d/bu7qdsv"
     target="_blank" rel="noopener sponsored nofollow">
     Amazonで見る
  </a>
  <small>※当サイトはアフィリエイト広告を利用しています</small>
</div>


  <div id="info">時代をえらんでカードをめくろう！ 〇の部分だけを「ひらがな」で答えると開くよ。</div>
  <div id="town" role="img" aria-label="町エリア"></div>
  <div id="cards" aria-label="カードエリア"></div>

  <section id="zukanPanel" aria-hidden="true">
    <div id="zukanHead">
      <h2>カード図鑑（章ごと）</h2>
      <button id="closeZukan" aria-label="図鑑をとじる">とじる</button>
    </div>
    <div id="zukanList"></div>
    <div id="completeMsg"></div>
  </section>


  <!-- 下部の固定バナー枠（必要なら中身を ad ユニットに差し替え） -->
  <div class="adbar" aria-label="広告枠">
    <div class="adslot">広告スペース（<ins class="adsbygoogle">…</ins> を入れる場所）</div>
  </div>
  <footer aria-hidden="true"></footer>
</div>

<div class="landscapeWarn">縦向きで遊んでね🔄</div>

<!-- クイズ用モーダル（漢字はふりがなつき、〇は手動設定のまま表示） -->
<div id="quizModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="modal-bg" id="quizBg"></div>
  <div class="modal-box">
    <div id="quizTitle" class="quiz-title"></div>
    <p class="quiz-instruction">
      〇のところだけを <b>ひらがな</b> でこたえてね。<br>
      空欄がいくつかあるときは <b>スペース / ・ / 、 / ／</b> で区切ってOK。
      <span id="quizHint" style="color:#666"></span>
    </p>
    <input id="quizInput" type="text" inputmode="kana" autocomplete="off"
           placeholder="ここに ひらがな を入力（例：てんぽう）" />
    <div class="quiz-actions">
      <button id="quizCancel">やめる</button>
      <button id="quizOk">決定</button>
    </div>
  </div>
</div>

<script>
/* =========================================================
   データセット（江戸／室町）
   - 〇の数は“答えのひらがな数”に手動で合わせ済み
   - 見えている漢字に ruby を付与（〇はそのまま）
   ========================================================= */
const dataSets = {
  /* ---------- 江戸時代 ---------- */
  edo: {
    title: "江戸時代",
    LS_KEY: "cards_edo_complete_v1",
    chapters: {
      "初期": {
        "1603 〇〇幕府がはじまる": { text: "家康が将軍になり、江戸で国の中心が動き出す。", icon: "🏯", year: 1603 },
        "1615 〇〇〇〇の陣":       { text: "大きなたたかいが終わり、豊臣の時代に幕。", icon: "⚔️", year: 1615 },
        "1635 〇〇〇交代":          { text: "大名は国と江戸を行き来するきまりに。", icon: "🚶", year: 1635 }, /* さんきん=3 */
        "1637 島〇〇・天〇〇の乱":  { text: "九州で大きな一揆が起きる。", icon: "🔥", year: 1637 },
        "1639 〇〇〇〇〇船の来航禁止": { text: "外国船の出入りをしめて、交流をせいげん。", icon: "⛵", year: 1639 },
        "1641 〇〇〇での貿易":      { text: "オランダ商館が長崎の出島へ。", icon: "🏝️", year: 1641 },
        "1657 〇〇〇〇の大火":      { text: "江戸の町が大火事。町づくりを立て直す。", icon: "🔥", year: 1657 },
        "1657 〇〇〇〇〇〇へ移転":  { text: "遊郭が浅草千束の新しい場所へ。", icon: "🏮", year: 1657 }
      },
      "中期": {
        "1688 〇〇〇〇文化がさかえる": { text: "町人の文化が花ひらく。歌舞伎や浮世絵が人気。", icon: "🎭", year: 1688 },
        "1716 〇〇〇〇の改革":         { text: "吉宗がくらしと財政を立て直す工夫をはじめる。", icon: "📜", year: 1716 }, /* 享保=4（きょうほ） */
        "1720 〇〇〇〇をとりいれる":   { text: "海外の学びが広がり、知識がふえる。", icon: "📚", year: 1720 },
        "1720 〇〇〇〇〇のしくみ":     { text: "火事にそなえる町人の組ができる。", icon: "🚒", year: 1720 },
        "1730 〇〇のながれを整える":   { text: "商いのきまりをととのえ、町を元気に。", icon: "🧺", year: 1730 },
        "1775 〇〇〇の時代":           { text: "商いを活かす政治でお金の流れをよくする試み。", icon: "💹", year: 1775 },
        "1783 〇〇〇〇のききん":       { text: "寒さや不作で食べ物がたりなくなる。", icon: "🌾", year: 1783 }
      },
      "幕末": {
        "1787 〇〇〇〇の改革":         { text: "くらしをひきしめ、教育も大切にする方針。", icon: "📝", year: 1787 },
        "1825 〇〇〇〇〇打払令":       { text: "近づく外国船を追いはらうきまり。", icon: "📣", year: 1825 },
        "1837 〇〇〇〇〇〇〇〇〇〇の乱": { text: "大阪で人びとの苦しさが爆発。", icon: "⚠️", year: 1837 },
        "1841 〇〇〇〇の改革":           { text: "町の決まりを見直し、ぜいたくをおさえる。", icon: "📏", year: 1841 }, /* 天保=3（てんぽ） */
        "1853 〇〇〇〇が来る":         { text: "アメリカの船が浦賀に来航。", icon: "⛴️", year: 1853 },
        "1854 〇〇〇条約":             { text: "日本は港を開き、交流をはじめる。", icon: "🤝", year: 1854 },
        "1858 〇〇〇〇の条約":         { text: "いくつかの国とむすび、貿易が広がる。", icon: "🌐", year: 1858 },
        "1858 〇〇〇〇の大獄":         { text: "意見のちがいで多くの人が処罰される。", icon: "⚖️", year: 1858 },
        "1860 〇〇〇〇〇〇〇〇の変":   { text: "政治の対立が事件に。", icon: "🗡️", year: 1860 },
        "1867 〇〇〇〇奉還":           { text: "政（まつりごと）を朝廷にお返し。", icon: "🗝️", year: 1867 },
        "1868 〇〇〇へ":               { text: "新しい時代のスタート！", icon: "🌸", year: 1868 }
      }
    },
    ruby: {
      "1603 〇〇幕府がはじまる": "〇〇<ruby>幕府<rt>ばくふ</rt></ruby>がはじまる",
      "1615 〇〇〇〇の陣": "〇〇〇〇の<ruby>陣<rt>じん</rt></ruby>",
      "1635 〇〇〇交代": "〇〇〇<ruby>交代<rt>こうたい</rt></ruby>",
      "1637 島〇〇・天〇〇の乱": "島〇〇・天〇〇の<ruby>乱<rt>らん</rt></ruby>",
      "1639 〇〇〇〇〇船の来航禁止": "〇〇〇〇〇<ruby>船<rt>せん</rt></ruby>の<ruby>来航<rt>らいこう</rt></ruby><ruby>禁止<rt>きんし</rt></ruby>",
      "1641 〇〇〇での貿易": "〇〇〇での<ruby>貿易<rt>ぼうえき</rt></ruby>",
      "1657 〇〇〇〇の大火": "〇〇〇〇の<ruby>大火<rt>たいか</rt></ruby>",
      "1657 〇〇〇〇〇〇へ移転": "〇〇〇〇〇〇へ<ruby>移転<rt>いてん</rt></ruby>",
      "1688 〇〇〇〇文化がさかえる": "〇〇〇〇<ruby>文化<rt>ぶんか</rt></ruby>がさかえる",
      "1716 〇〇〇〇の改革": "〇〇〇〇の<ruby>改革<rt>かいかく</rt></ruby>",
      "1720 〇〇〇〇をとりいれる": "〇〇〇〇をとりいれる",
      "1720 〇〇〇〇〇のしくみ": "〇〇〇〇〇のしくみ",
      "1730 〇〇のながれを整える": "〇〇のながれを<ruby>整える<rt>ととのえる</rt></ruby>",
      "1775 〇〇〇の時代": "〇〇〇の<ruby>時代<rt>じだい</rt></ruby>",
      "1783 〇〇〇〇のききん": "〇〇〇〇のききん",
      "1787 〇〇〇〇の改革": "〇〇〇〇の<ruby>改革<rt>かいかく</rt></ruby>",
      "1825 〇〇〇〇〇打払令": "〇〇〇〇〇<ruby>打払令<rt>うちはらいれい</rt></ruby>",
      "1837 〇〇〇〇〇〇〇〇〇〇の乱": "〇〇〇〇〇〇〇〇〇〇の<ruby>乱<rt>らん</rt></ruby>",
      "1841 〇〇〇〇の改革": "〇〇〇〇の<ruby>改革<rt>かいかく</rt></ruby>",
      "1853 〇〇〇〇が来る": "〇〇〇〇が<ruby>来<rt>く</rt></ruby>る",
      "1854 〇〇〇条約": "〇〇〇<ruby>条約<rt>じょうやく</rt></ruby>",
      "1858 〇〇〇〇の条約": "〇〇〇〇の<ruby>条約<rt>じょうやく</rt></ruby>",
      "1858 〇〇〇〇の大獄": "〇〇〇〇の<ruby>大獄<rt>たいごく</rt></ruby>",
      "1860 〇〇〇〇〇〇〇〇の変": "〇〇〇〇〇〇〇〇の<ruby>変<rt>へん</rt></ruby>",
      "1867 〇〇〇〇奉還": "〇〇〇〇<ruby>奉還<rt>ほうかん</rt></ruby>",
      "1868 〇〇〇へ": "〇〇〇へ"
    },
    blanks: {
      "1603 〇〇幕府がはじまる": ["えど"],
      "1615 〇〇〇〇の陣": ["おおさか"],
      "1635 〇〇〇交代": ["さんきん"],
      "1637 島〇〇・天〇〇の乱": ["ばら","くさ"],
      "1639 〇〇〇〇〇船の来航禁止": ["ぽるとがる"],
      "1641 〇〇〇での貿易": ["でじま"],
      "1657 〇〇〇〇の大火": ["めいれき"],
      "1657 〇〇〇〇〇〇へ移転": ["しんよしわら"],
      "1688 〇〇〇〇文化がさかえる": ["げんろく"],
      "1716 〇〇〇〇の改革": ["きょうほ"],   /* 簡略読み（“きょうほう”ではなく “きょうほ”） */
      "1720 〇〇〇〇をとりいれる": ["ようしょ"],
      "1720 〇〇〇〇〇のしくみ": ["まちびけし"],
      "1730 〇〇のながれを整える": ["もの"],
      "1775 〇〇〇の時代": ["たぬま"],
      "1783 〇〇〇〇のききん": ["てんめい"],
      "1787 〇〇〇〇の改革": ["かんせい"],
      "1825 〇〇〇〇〇打払令": ["いこくせん"],
      "1837 〇〇〇〇〇〇〇〇〇〇の乱": ["おおしおへいはちろう"],
      "1841 〇〇〇〇の改革": ["てんぽう"],
      "1853 〇〇〇〇が来る": ["くろふね"],
      "1854 〇〇〇条約": ["わしん"],
      "1858 〇〇〇〇の条約": ["あんせい"],
      "1858 〇〇〇〇の大獄": ["あんせい"],
      "1860 〇〇〇〇〇〇〇〇の変": ["さくらだもんがい"],
      "1867 〇〇〇〇奉還": ["たいせい"],
      "1868 〇〇〇へ": ["めいじ"]
    }
  },

  /* ---------- 室町時代 ---------- */
  muromachi: {
    title: "室町時代",
    LS_KEY: "cards_muromachi_complete_v1",
    chapters: {
      "初期（南北朝〜）": {
        "1336 〇〇〇〇幕府がはじまる": { text: "足利氏の幕府が京都で始まる。", icon: "🏯", year: 1336 },
        "1392 〇〇〇〇〇〇〇統一":       { text: "南朝と北朝がひとつになる。", icon: "🤝", year: 1392 }, /* なんぼくちょう=6 */
        "1397 〇〇〇〇が建てられる":   { text: "きらびやかな建物（鹿苑寺）。", icon: "🏯", year: 1397 },
        "1390 〇〇〇〇文化がさかえる": { text: "能や茶の湯など都の文化が発展。", icon: "🎭", year: 1390 },
        "1401 〇〇〇〇貿易がはじまる": { text: "明との勘合（証明）を用いた貿易。", icon: "🛶", year: 1401 }
      },
      "中期（文化と争い）": {
        "1439 〇〇〇〇〇の乱":         { text: "関東で大きな戦い（将軍側と対立）。", icon: "⚔️", year: 1439 }, /* えいきょう=5 */
        "1441 〇〇〇の乱":             { text: "将軍が討たれる事件（赤松氏ら）。", icon: "⚠️", year: 1441 }, /* かきつ=3 */
        "1467 〇〇〇〇の乱":           { text: "京都が荒廃、のちの戦国時代へ。", icon: "🔥", year: 1467 }, /* おうにん=4 */
        "1485 〇〇〇〇国一揆":         { text: "人びとが協力して自治（山城国）。", icon: "🛡️", year: 1485 },
        "1489 〇〇〇〇が建てられる":   { text: "静かな美（慈照寺・銀閣）。", icon: "🏯", year: 1489 },
        "1493 〇〇〇〇の政変":         { text: "細川氏の政変で権力が移る。", icon: "🌀", year: 1493 }
      },
      "後期（戦国の入口）": {
        "1543 〇〇〇〇伝来":           { text: "新しい道具が日本へ（鉄砲）。", icon: "🔫", year: 1543 }, /* てっぽう=4 */
        "1549 〇〇〇〇教伝来":         { text: "キリスト教が日本に広がる。", icon: "⛪", year: 1549 },
        "1555 〇〇〇〇〇の戦い":       { text: "厳島の戦い、武将が勢力拡大。", icon: "🗺️", year: 1555 },
        "1573 〇〇〇〇幕府がおわる":   { text: "将軍追放で幕府が終わりへ。", icon: "🌅", year: 1573 }
      }
    },
    ruby: {
      "1336 〇〇〇〇幕府がはじまる": "〇〇〇〇<ruby>幕府<rt>ばくふ</rt></ruby>がはじまる",
      "1392 〇〇〇〇〇〇〇統一":       "〇〇〇〇〇〇<ruby>統一<rt>とういつ</rt></ruby>",
      "1397 〇〇〇〇が建てられる":   "〇〇〇〇が<ruby>建<rt>た</rt></ruby>てられる",
      "1390 〇〇〇〇文化がさかえる": "〇〇〇〇<ruby>文化<rt>ぶんか</rt></ruby>がさかえる",
      "1401 〇〇〇〇貿易がはじまる": "〇〇〇〇<ruby>貿易<rt>ぼうえき</rt></ruby>がはじまる",


      "1439 〇〇〇〇〇の乱":         "〇〇〇〇〇の<ruby>乱<rt>らん</rt></ruby>",
      "1441 〇〇〇の乱":             "〇〇〇の<ruby>乱<rt>らん</rt></ruby>",
      "1467 〇〇〇〇の乱":           "〇〇〇〇の<ruby>乱<rt>らん</rt></ruby>",
      "1485 〇〇〇〇国一揆": "〇〇〇〇<ruby>国<rt>くに</rt></ruby><ruby>一揆<rt>いっき</rt></ruby>",
      "1489 〇〇〇〇が建てられる":   "〇〇〇〇が<ruby>建<rt>た</rt></ruby>てられる",
      "1493 〇〇〇〇の政変":         "〇〇〇〇の<ruby>政変<rt>せいへん</rt></ruby>",

      "1543 〇〇〇〇伝来":           "〇〇〇〇<ruby>伝来<rt>でんらい</rt></ruby>",
      "1549 〇〇〇〇教伝来": "〇〇〇〇<ruby>教<rt>きょう</rt></ruby><ruby>伝来<rt>でんらい</rt></ruby>",
      "1555 〇〇〇〇〇の戦い":       "〇〇〇〇〇の<ruby>戦<rt>たたか</rt></ruby>い",
      "1573 〇〇〇〇幕府がおわる":   "〇〇〇〇<ruby>幕府<rt>ばくふ</rt></ruby>が<ruby>終<rt>お</rt></ruby>わる"
    },
    blanks: {
      "1336 〇〇〇〇幕府がはじまる": ["むろまち"],
      "1392 〇〇〇〇〇〇〇統一":       ["なんぼくちょう"],
      "1397 〇〇〇〇が建てられる":   ["きんかく"],
      "1390 〇〇〇〇文化がさかえる": ["きたやま"],
      "1401 〇〇〇〇貿易がはじまる": ["かんごう"],

      "1439 〇〇〇〇〇の乱":         ["えいきょう"],
      "1441 〇〇〇の乱":             ["かきつ"],
      "1467 〇〇〇〇の乱":           ["おうにん"],
      "1485 〇〇〇〇国一揆":         ["やましろ"],
      "1489 〇〇〇〇が建てられる":   ["ぎんかく"],
      "1493 〇〇〇〇の政変":         ["めいおう"],

      "1543 〇〇〇〇伝来":           ["てっぽう"],
      "1549 〇〇〇〇教伝来":         ["きりすと"],
      "1555 〇〇〇〇〇の戦い":       ["いつくしま"],
      "1573 〇〇〇〇幕府がおわる":   ["むろまち"]
    }
  }
};

/* ========= 共通ユーティリティ ========= */
const eraSelect = document.getElementById("eraSelect");
const chapterFilter = document.getElementById("chapterFilter");
const infoBox = document.getElementById("info");
const town = document.getElementById("town");
const zukanPanel = document.getElementById("zukanPanel");
const zukanList = document.getElementById("zukanList");
const completeMsg = document.getElementById("completeMsg");
const zukanBtn = document.getElementById("zukanBtn");
const closeZukan = document.getElementById("closeZukan");
const resetBtn = document.getElementById("resetBtn");

const quizModal  = document.getElementById("quizModal");
const quizTitle  = document.getElementById("quizTitle");
const quizHint   = document.getElementById("quizHint");
const quizInput  = document.getElementById("quizInput");
const quizOk     = document.getElementById("quizOk");
const quizCancel = document.getElementById("quizCancel");
const quizBg     = document.getElementById("quizBg");

let currentEra = "edo";
let gotCards = {}; // 現在の時代の進捗

function onlyHiraAndSep(s){ return /^[\u3041-\u3096\s・,，、/／]+$/.test(s); }
function splitTokens(ans){
  let s = ans.replace(/[・,，、/／]+/g, ' ');
  s = s.replace(/\s+/g, ' ').trim();
  return s ? s.split(' ') : [];
}
function persist(){ try { localStorage.setItem(dataSets[currentEra].LS_KEY, JSON.stringify(gotCards)); } catch(e){} }
function loadProgress(){
  const raw = localStorage.getItem(dataSets[currentEra].LS_KEY);
  try{ gotCards = raw ? JSON.parse(raw) : {}; } catch{ gotCards = {}; }
}

/* ========= 表示構築 ========= */
function withRubyMasked(fullName){
  const m = dataSets[currentEra].ruby[fullName];
  if(m) {
    const sp = fullName.indexOf(" ");
    const year = fullName.slice(0, sp);
    return `<span class="yr">${year}</span> ${m}`;
  }
  return fullName;
}

function buildChapterFilter(){
  chapterFilter.innerHTML = `<option value="ALL">章：ぜんぶ</option>`;
  const chapters = dataSets[currentEra].chapters;
  Object.keys(chapters).forEach(ch=>{
    chapterFilter.innerHTML += `<option value="${ch}">${ch}</option>`;
  });
}

function buildCards(){
  const wrap = document.getElementById("cards");
  wrap.innerHTML = "";
  const sel = chapterFilter.value;
  const chapters = dataSets[currentEra].chapters;
  Object.keys(chapters).forEach(ch=>{
    if(sel!=="ALL" && sel!==ch) return;
    for(const name in chapters[ch]){
      const el = document.createElement("div");
      el.className = "card";
      el.dataset.card = name;
      if(gotCards[name]) { el.innerHTML = withRubyMasked(name); el.classList.add("done"); }
      else {
        // ヒントとして年だけ見せる
        el.textContent = "？\n" + name.split(" ")[0];
      }
      el.addEventListener("click", ()=>onCardClick(el, name, ch));
      wrap.appendChild(el);
    }
  });
}

function renderZukan(){
  zukanList.innerHTML = "";
  let allComplete = true;
  const chapters = dataSets[currentEra].chapters;
  for(const ch in chapters){
    const section = document.createElement("div");
    section.className = "zukanSec";
    section.innerHTML = `<h3>${ch}</h3>`;
    for(const name in chapters[ch]){
      const div = document.createElement("div");
      div.className = "zCard";
      if(gotCards[name]){
        div.innerHTML = withRubyMasked(name);
      }else{
        div.textContent = "？？？";
        div.classList.add("locked");
        allComplete = false;
      }
      section.appendChild(div);
    }
    zukanList.appendChild(section);
  }
  if(allComplete){
    completeMsg.textContent = `🎉 ${dataSets[currentEra].title}コンプリート！おめでとう！ 🎉`;
    launchPetals();
  }else{
    completeMsg.textContent = "";
  }
}

function launchPetals(){
  for(let i=0;i<24;i++){
    const p=document.createElement("div");
    p.className="petal";
    p.textContent="🌸";
    p.style.left = Math.random()*100 + "vw";
    p.style.animationDuration = (3 + Math.random()*3) + "s";
    document.body.appendChild(p);
    setTimeout(()=>p.remove(), 7000);
  }
}

/* ========= クイズ（モーダル） ========= */
let quizCtx = { card:null, name:"", ch:"", expected:[] };

function openQuiz(card, name, ch){
  const expected = dataSets[currentEra].blanks[name];
  if(!expected){ alert("このカードの空欄答えが未登録です"); return; }
  quizCtx = { card, name, ch, expected };

  quizTitle.innerHTML = withRubyMasked(name);
  quizHint.textContent = expected.length >= 2
    ? `空欄は ${expected.length} こ。順番に入力してね`
    : `空欄は 1 こ。例：えど`;

  quizModal.classList.add("active");
  quizModal.setAttribute("aria-hidden","false");
  quizInput.value = "";
  setTimeout(()=>quizInput.focus(), 50);
}
function closeQuiz(){
  quizModal.classList.remove("active");
  quizModal.setAttribute("aria-hidden","true");
}

function submitQuiz(){
  const { card, name, ch, expected } = quizCtx;
  if(!card) return;
  const raw = quizInput.value.trim();
  if(!onlyHiraAndSep(raw)){
    alert("ひらがな だけで入力してね（区切りは スペース/・/、/，/／ だけOK）");
    quizInput.focus(); return;
  }
  const tokens = splitTokens(raw);
  const joined = tokens.join("");
  const expectJoined = expected.join("");

  let ok = false;
  if(tokens.length === expected.length){
    ok = tokens.every((t,i)=>t === expected[i]);
  }else if(tokens.length === 1){
    ok = joined === expectJoined; // まとめ入力OK
  }

  if(!ok){
    alert(`ざんねん！せいかいは「${expected.join(" ・ ")}」だよ（〇の部分だけ）`);
    quizInput.focus();
    return;
  }

  // 正解処理
  closeQuiz();
  const data = dataSets[currentEra].chapters[ch][name];
  card.innerHTML = withRubyMasked(name);
  card.classList.add("done");
  infoBox.textContent = data.text;

  const b = document.createElement("div");
  b.className = "building";
  b.textContent = data.icon;
  b.style.left = (Math.random()*80 + 5) + "%";
  b.style.top  = (Math.random()*70 + 5) + "%";
  town.appendChild(b);
  setTimeout(()=>b.classList.add("show"),50);

  const v = document.createElement("div");
  v.className = "villager";
  v.textContent = Math.random()>0.5 ? "😊" : "👘";
  v.style.top = Math.floor(Math.random()*(town.clientHeight-40)) + "px";
  town.appendChild(v);

  gotCards[name] = true;
  persist();
  renderZukan();
}

function onCardClick(card, name, ch){
  if(card.classList.contains("done")) return;
  openQuiz(card, name, ch);
}

/* ========= イベント ========= */
zukanBtn.addEventListener("click", ()=>{
  const active = !zukanPanel.classList.contains("active");
  zukanPanel.classList.toggle("active");
  zukanPanel.setAttribute("aria-hidden", active ? "false" : "true");
  zukanBtn.setAttribute("aria-expanded", String(active));
});
closeZukan.addEventListener("click", ()=>{
  zukanPanel.classList.remove("active");
  zukanPanel.setAttribute("aria-hidden","true");
  zukanBtn.setAttribute("aria-expanded","false");
});
chapterFilter.addEventListener("change", buildCards);

resetBtn.addEventListener("click", ()=>{
  if(!confirm(`${dataSets[currentEra].title}の進捗（開いたカード・町づくり）をリセットします。よろしいですか？`)) return;
  localStorage.removeItem(dataSets[currentEra].LS_KEY);
  gotCards = {};
  document.querySelectorAll("#town .building, #town .villager").forEach(el=>el.remove());
  infoBox.textContent = "時代をえらんでカードをめくろう！ 〇の部分だけを「ひらがな」で答えると開くよ。";
  zukanPanel.classList.remove("active");
  zukanPanel.setAttribute("aria-hidden","true");
  zukanBtn.setAttribute("aria-expanded","false");
  buildCards();
  renderZukan();
  alert("リセットしました！");
});

quizOk.addEventListener("click", submitQuiz);
quizCancel.addEventListener("click", closeQuiz);
quizBg.addEventListener("click", closeQuiz);
quizInput.addEventListener("keydown", (e)=>{
  if(e.key === "Enter") submitQuiz();
  if(e.key === "Escape") closeQuiz();
});

eraSelect.addEventListener("change", ()=>{
  currentEra = eraSelect.value;
  // 画面初期化
  document.querySelectorAll("#town .building, #town .villager").forEach(el=>el.remove());
  loadProgress();
  buildChapterFilter();
  buildCards();
  renderZukan();
});

/* ========= 初期描画 ========= */
loadProgress();
buildChapterFilter();
buildCards();
renderZukan();

// 保存復元（建物＆住人）
(function restoreTown(){
  const chapters = dataSets[currentEra].chapters;
  for(const ch in chapters){
    for(const name in chapters[ch]){
      if(!gotCards[name]) continue;
      const item = chapters[ch][name];
      const b = document.createElement("div");
      b.className = "building show";
      b.textContent = item.icon;
      b.style.left = (Math.random()*80 + 5) + "%";
      b.style.top = (Math.random()*70 + 5) + "%";
      town.appendChild(b);
      const v = document.createElement("div");
      v.className = "villager";
      v.textContent = Math.random()>0.5 ? "😊" : "👘";
      v.style.top = Math.floor(Math.random()* (town.clientHeight-40)) + "px";
      town.appendChild(v);
    }
  }
})();
</script>

<!--
  固定のバナー広告を使う場合は、.adslot の中身をあなたの広告ユニットに置換し、
  直後で (adsbygoogle = window.adsbygoogle || []).push({}); を呼び出してください。
-->
  <p style="padding:0 12px;">
  <strong>子ども向け 歴史 学習</strong>として、まずは
  <a href="#cards">江戸時代のクイズ</a>と
  <a href="#cards">室町時代のクイズ</a>から始めてみよう。図鑑で
  <a href="#zukanPanel">年表</a>も確認できるよ。
</p>


</body>
</html>

















